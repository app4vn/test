/* style.css */
/* Reset cơ bản & Kiểu toàn cục */
* {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
}

/* Định nghĩa Biến CSS cho Themes */
:root {
    /* Theme Sáng (Mặc định) */
    --bg-primary: #f4f4f4;
    --bg-secondary: #fff;
    --bg-sidebar: #f8f9fa;
    --bg-header: #343a40;
    --bg-input: #fff;
    --accent-color: #007bff;
    --accent-color-hover: #0056b3;

    --bg-button-primary: var(--accent-color);
    --bg-button-primary-hover: var(--accent-color-hover);
    --bg-button-secondary: #6c757d;
    --bg-button-secondary-hover: #5a6268;
    --bg-button-danger: #dc3545;
    --bg-button-danger-hover: #c82333;
    --bg-code-block: #f5f2f0;
    --bg-content-display: #f8f9fa;
    --bg-note-item-hover: #e9ecef;
    --bg-note-item-active: #cfe2ff;
    --bg-tag-item: #6c757d;
    --bg-tag-item-active: var(--accent-color);
    --dog-ear-color: #e0e0e0;
    --dog-ear-shadow: rgba(0,0,0,0.2);

    --text-primary: #333;
    --text-secondary: #6c757d;
    --text-header: #fff;
    --text-button: #fff;
    --text-link: var(--accent-color);
    --text-link-hover: var(--accent-color-hover);
    --text-placeholder: #6c757d;
    --text-error: #dc3545;
    --text-code-block: #393a34;
    --text-highlight: #333;
    --text-note-title: var(--accent-color);

    --border-primary: #dee2e6;
    --border-secondary: #e0e0e0;
    --border-input: #ccc;
    --border-input-focus: var(--accent-color);
    --border-content-display: #e9ecef;
    --border-code-block: #ddd;

    --shadow-primary: rgba(0,0,0,0.1);
    --shadow-focus: rgba(0, 123, 255, 0.25);
    --highlight-bg: yellow;
    --font-content: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
    --header-height-desktop: 60px;
    --header-height-mobile: 50px;

    /* Biến màu cho Banner Việc Gấp - Theme Sáng */
    --bg-urgent-banner: #fff3cd;
    --border-urgent-banner: #ffeeba;
    --text-urgent-banner-content: #664d03;
}

body.theme-dark {
    --bg-primary: #212529; --bg-secondary: #343a40; --bg-sidebar: #2b3035; --bg-header: #1c1e21; --bg-input: #495057;
    --bg-button-secondary: #5c636a; --bg-button-secondary-hover: #4f555a; --bg-button-danger: #dc3545; --bg-button-danger-hover: #bb2d3b;
    --bg-code-block: #282c34; --bg-content-display: #3a3f44; --bg-note-item-hover: #495057; --bg-note-item-active: var(--accent-color);
    --bg-tag-item: #5c636a; --dog-ear-color: #5c636a; --dog-ear-shadow: rgba(0,0,0,0.4);
    --text-primary: #e9ecef; --text-secondary: #adb5bd; --text-header: #fff; --text-button: #fff; --text-placeholder: #adb5bd;
    --text-error: #f17c7c; --text-code-block: #abb2bf; --text-highlight: #212529;
    --border-primary: #495057; --border-secondary: #5c636a; --border-input: #6c757d; --border-content-display: #495057; --border-code-block: #5c636a;
    --shadow-primary: rgba(255,255,255,0.1); --highlight-bg: #ffec80;

    /* Biến màu cho Banner Việc Gấp - Theme Tối */
    --bg-urgent-banner: #3b3103;
    --border-urgent-banner: #5c4a02;
    --text-urgent-banner-content: #ffecb3;
}
body.theme-gruvbox-light {
    --bg-primary: #fbf1c7; --bg-secondary: #ebdbb2; --bg-sidebar: #f2e5bc; --bg-header: #3c3836; --bg-input: #fbf1c7;
    --bg-button-secondary: #7c6f64; --bg-button-secondary-hover: #665c54; --bg-button-danger: #cc241d; --bg-button-danger-hover: #9d0006;
    --bg-code-block: #f2e5bc; --bg-content-display: #f2e5bc; --bg-note-item-hover: #d5c4a1; --bg-note-item-active: #bdae93;
    --bg-tag-item: #7c6f64; --dog-ear-color: #bdae93; --dog-ear-shadow: rgba(60, 56, 54, 0.2);
    --text-primary: #3c3836; --text-secondary: #665c54; --text-header: #ebdbb2; --text-button: #ebdbb2; --text-placeholder: #928374;
    --text-error: #cc241d; --text-code-block: #3c3836; --text-highlight: #3c3836;
    --border-primary: #d5c4a1; --border-secondary: #bdae93; --border-input: #bdae93; --border-content-display: #d5c4a1; --border-code-block: #bdae93;
    --shadow-primary: rgba(0,0,0,0.08); --highlight-bg: #fabd2f;

    /* Biến màu cho Banner Việc Gấp - Theme Gruvbox Sáng */
    --bg-urgent-banner: #fadf98;
    --border-urgent-banner: #fabd2f;
    --text-urgent-banner-content: #665c54;
}
body.theme-dracula {
    --bg-primary: #282a36; --bg-secondary: #44475a; --bg-sidebar: #3a3c4e; --bg-header: #1e1f29; --bg-input: #44475a;
    --bg-button-secondary: #6272a4; --bg-button-secondary-hover: #52608d; --bg-button-danger: #ff5555; --bg-button-danger-hover: #e84444;
    --bg-code-block: #21222c; --bg-content-display: #44475a; --bg-note-item-hover: #53566e; --bg-note-item-active: var(--accent-color);
    --bg-tag-item: #6272a4; --dog-ear-color: #6272a4; --dog-ear-shadow: rgba(0,0,0,0.5);
    --text-primary: #f8f8f2; --text-secondary: #bd93f9; --text-header: #f8f8f2; --text-button: #f8f8f2; --text-placeholder: #9a9bb7;
    --text-error: #ff5555; --text-code-block: #f8f8f2; --text-highlight: #282a36;
    --border-primary: #6272a4; --border-secondary: #44475a; --border-input: #6272a4; --border-content-display: #6272a4; --border-code-block: #44475a;
    --shadow-primary: rgba(0,0,0,0.3); --highlight-bg: #f1fa8c;

    /* Biến màu cho Banner Việc Gấp - Theme Dracula */
    --bg-urgent-banner: #423521; /* Màu nâu cam tối */
    --border-urgent-banner: #ffb86c; /* Màu cam Dracula */
    --text-urgent-banner-content: #f1fa8c; /* Màu vàng Dracula */
}
body.theme-solarized-light {
    --bg-primary: #fdf6e3; --bg-secondary: #eee8d5; --bg-sidebar: #f6f0e0; --bg-header: #002b36; --bg-input: #fdf6e3;
    --bg-button-secondary: #93a1a1; --bg-button-secondary-hover: #839496; --bg-button-danger: #dc322f; --bg-button-danger-hover: #cb4b16;
    --bg-code-block: #f6f0e0; --bg-content-display: #eee8d5; --bg-note-item-hover: #e0daca; --bg-note-item-active: var(--accent-color);
    --bg-tag-item: #93a1a1; --dog-ear-color: #93a1a1; --dog-ear-shadow: rgba(0, 43, 54, 0.2);
    --text-primary: #586e75; --text-secondary: #839496; --text-header: #eee8d5; --text-button: #fdf6e3; --text-placeholder: #93a1a1;
    --text-error: #dc322f; --text-code-block: #586e75; --text-highlight: #002b36;
    --border-primary: #93a1a1; --border-secondary: #eee8d5; --border-input: #93a1a1; --border-content-display: #93a1a1; --border-code-block: #93a1a1;
    --shadow-primary: rgba(0, 43, 54, 0.15); --highlight-bg: #b58900;

    /* Biến màu cho Banner Việc Gấp - Theme Solarized Sáng */
    --bg-urgent-banner: #eee8d5;
    --border-urgent-banner: #b58900;
    --text-urgent-banner-content: #586e75;
}

/* ... (Toàn bộ CSS gốc của bạn từ html {} đến hết .note-item-content-preview .todo-preview-item .todo-deadline-preview.overdue {}) ... */
/* Bạn cần đảm bảo toàn bộ CSS gốc của bạn được giữ lại ở đây */

html { scroll-behavior: smooth; }
body { font-family: var(--font-content); line-height: 1.6; color: var(--text-primary); background-color: var(--bg-primary); transition: background-color 0.3s ease, color 0.3s ease; overflow-y: scroll; }
body.modal-open, body.sidebar-open { overflow: hidden; }
h1, h2 { margin-bottom: 0.8em; font-weight: 600; }
#notes-grid-view h2, #trash-view h2, #calendar-view h2 { margin-bottom: 20px; font-size: 1.6em; color: var(--text-primary); border-bottom: 1px solid var(--border-secondary); padding-bottom: 10px; }
#notes-grid-view h2 #active-tag-display { font-size: 0.8em; color: var(--text-link); font-weight: 500; margin-left: 10px; }
button { cursor: pointer; padding: 10px 15px; border: none; border-radius: 6px; font-size: 1em; transition: background-color 0.2s ease, box-shadow 0.2s ease, transform 0.1s ease; }
button:disabled { cursor: not-allowed; opacity: 0.7; }
button:active:not(:disabled) { transform: translateY(1px); box-shadow: inset 0 1px 3px var(--shadow-primary); }
.back-button { margin-bottom: 20px; background-color: var(--bg-secondary); color: var(--text-primary); border: 1px solid var(--border-primary); }
.back-button:hover { background-color: var(--bg-note-item-hover); }
input[type="text"], input[type="email"], input[type="password"], input[type="search"], input[type="date"], textarea, select { width: 100%; padding: 12px; margin-bottom: 12px; border: 1px solid var(--border-input); border-radius: 6px; font-size: 1em; background-color: var(--bg-input); color: var(--text-primary); transition: border-color 0.2s ease, box-shadow 0.2s ease, background-color 0.3s ease, color 0.3s ease; }
input::placeholder, textarea::placeholder { color: var(--text-placeholder); opacity: 1; }
input:focus, textarea:focus, select:focus { outline: none; border-color: var(--border-input-focus); box-shadow: 0 0 0 3px var(--shadow-focus); }
#search-input { margin-bottom: 0; }
textarea#note-content-input { min-height: 150px; resize: vertical; font-family: var(--font-content); }
hr { border: 0; height: 1px; background-color: var(--border-secondary); margin: 20px 0; }
.sidebar hr { margin: 15px 0; background-color: var(--border-primary); }
.button-primary { background-color: var(--bg-button-primary); color: var(--text-button); }
.button-primary:hover:not(:disabled) { background-color: var(--bg-button-primary-hover); }
.button-secondary { background-color: var(--bg-button-secondary); color: var(--text-button); }
.button-secondary:hover:not(:disabled) { background-color: var(--bg-button-secondary-hover); }
.button-danger { background-color: var(--bg-button-danger); color: var(--text-button); }
.button-danger:hover:not(:disabled) { background-color: var(--bg-button-danger-hover); }
.full-width { width: 100%; }
.error-message { color: var(--text-error); font-size: 0.9em; margin-top: 5px; min-height: 1.2em; text-align: left; }
#app-container { height: 100vh; display: flex; flex-direction: column; }
.app-header { background-color: var(--bg-header); color: var(--text-header); padding: 15px 25px; display: flex; justify-content: space-between; align-items: center; flex-shrink: 0; box-shadow: 0 2px 5px var(--shadow-primary); transition: background-color 0.3s ease, color 0.3s ease; position: relative; z-index: 1000; }
.app-header h1 { margin: 0; font-size: 1.5em; }
.user-info { display: flex; align-items: center; }
.user-info span { margin-right: 15px; font-weight: 500; }
.user-info .logged-out-element { margin-left: 10px; }

.main-content { display: flex; flex-grow: 1; position: relative; }
.sidebar { width: 240px; background-color: var(--bg-sidebar); padding: 20px; border-right: 1px solid var(--border-primary); overflow-y: auto; flex-shrink: 0; display: flex; flex-direction: column; transition: background-color 0.3s ease, border-color 0.3s ease, transform 0.3s ease; }
.sidebar h2 { font-size: 1.1em; margin-top: 0; color: var(--text-primary); padding-bottom: 8px; }
.sidebar .sidebar-settings h2, .sidebar .sidebar-settings h3 { font-size: 0.95em; margin-bottom: 10px; padding-bottom: 0; color: var(--text-secondary); font-weight: 500; border-bottom: none; }
.sidebar .sidebar-settings h2 { border-bottom: 1px solid var(--border-secondary); padding-bottom: 5px; }
.sidebar-button { display: flex; align-items: center; gap: 8px; width: 100%; text-align: left; padding: 10px 12px; background-color: transparent; color: var(--text-primary); border: 1px solid transparent; margin-bottom: 5px; border-radius: 6px; }
.sidebar-button:hover { background-color: var(--bg-note-item-hover); border-color: var(--border-primary); }
.sidebar-button.active { background-color: var(--accent-color); color: var(--text-button); border-color: var(--accent-color); font-weight: 500; }
.sidebar-button svg { width: 16px; height: 16px; flex-shrink: 0; }
#tags-list-container { margin-top: 10px; }
#tags-list-container .tag-item { display: inline-block; background-color: var(--bg-tag-item); color: var(--text-button); padding: 4px 10px; border-radius: 15px; font-size: 0.85em; margin-right: 6px; margin-bottom: 6px; cursor: pointer; transition: background-color 0.2s ease; }
#tags-list-container .tag-item:hover, #tags-list-container .tag-item.active { background-color: var(--bg-tag-item-active); }

.content-area { flex-grow: 1; padding: 30px 40px; background-color: var(--bg-secondary); transition: background-color 0.3s ease; }
body.theme-gruvbox-light .content-area, body.theme-solarized-light .content-area { background-color: var(--bg-primary); }

.grid-view-header, .calendar-view-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; padding-bottom: 15px; border-bottom: 1px solid var(--border-secondary); flex-wrap: wrap; gap: 10px; flex-shrink: 0; }
.grid-view-header h2, .calendar-view-header h2 { border-bottom: none; padding-bottom: 0; margin-bottom: 0; }
.sort-options { display: flex; align-items: center; gap: 10px; flex-wrap: wrap; }
.sort-options label { font-size: 0.9em; color: var(--text-secondary); margin-bottom: 0; margin-right: 5px; }
.sort-options select { width: auto; min-width: 150px; margin-bottom: 0; padding: 8px 12px; font-size: 0.9em; }

#notes-list-container, #trash-list-container { display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 20px; margin-top: 0; padding: 5px; }
.note-item { background-color: var(--bg-secondary); border: 1px solid var(--border-primary); border-radius: 8px; padding: 15px 20px; transition: box-shadow 0.2s ease, transform 0.2s ease, background-color 0.3s ease, border-color 0.3s ease; overflow: hidden; display: flex; flex-direction: column; min-height: 170px; box-shadow: 0 1px 3px var(--shadow-primary); position: relative; }
#notes-list-container .note-item:hover { box-shadow: 0 4px 12px var(--shadow-primary); border-color: var(--border-input-focus); background-color: var(--bg-note-item-hover); }
#notes-list-container .note-item { cursor: pointer; }
.note-item::before { content: ""; position: absolute; top: 0; right: 0; border-width: 0 25px 25px 0; border-style: solid; border-color: var(--bg-primary) var(--bg-primary) var(--dog-ear-color) var(--dog-ear-shadow); box-shadow: -1px 1px 3px var(--dog-ear-shadow); transition: border-color 0.3s ease, box-shadow 0.3s ease; }
body.theme-gruvbox-light .note-item::before, body.theme-solarized-light .note-item::before { border-color: var(--bg-primary) var(--bg-primary) var(--dog-ear-color) var(--dog-ear-color); }
.note-item h3 { font-size: 1.1em; margin-bottom: 8px; color: var(--text-note-title); display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; text-overflow: ellipsis; white-space: normal; min-height: 2.4em; }
.note-item-content-preview { font-size: 0.9em; color: var(--text-secondary); margin-bottom: 10px; overflow: hidden; word-break: break-word; font-family: var(--font-content); }
.note-item-content-preview:not(:has(.todo-preview-item)) { display: -webkit-box; -webkit-line-clamp: 5; -webkit-box-orient: vertical; text-overflow: ellipsis; white-space: normal; }
.note-item-date { font-size: 0.8em; color: var(--text-secondary); margin-top: 8px; text-align: right; flex-shrink: 0; }
#notes-list-container > p, #trash-list-container > p { grid-column: 1 / -1; text-align: center; color: var(--text-secondary); margin-top: 30px; }
.trashed-note-actions { margin-top: 15px; display: flex; gap: 10px; justify-content: flex-end; }
.trashed-note-actions button { padding: 6px 10px; font-size: 0.85em; }
#note-detail-view { position: relative; }
#note-detail-view h2 { padding-bottom: 15px; margin-bottom: 20px; color: var(--text-note-title); font-size: 1.8em; word-break: break-word; padding-right: 40px; flex-shrink: 0; }
.tags-display { margin-bottom: 20px; flex-shrink: 0; }
.tags-display .tag { display: inline-block; background-color: var(--bg-button-primary); color: var(--text-button); padding: 4px 10px; border-radius: 6px; font-size: 0.9em; margin-right: 8px; margin-bottom: 8px; }
.content-display { margin-top: 15px; margin-bottom: 25px; white-space: pre-wrap; word-wrap: break-word; line-height: 1.7; color: var(--text-primary); background-color: var(--bg-content-display); padding: 20px; border: 1px solid var(--border-content-display); border-radius: 8px; transition: background-color 0.3s ease, border-color 0.3s ease, color 0.3s ease; font-family: var(--font-content); flex-shrink: 0; }
#note-detail-code { background-color: var(--bg-code-block); color: var(--text-code-block); padding: 20px; border-radius: 8px; overflow-x: auto; white-space: pre; font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, Courier, monospace; font-size: 0.95em; line-height: 1.5; margin-top: 15px; margin-bottom: 25px; border: 1px solid var(--border-code-block); transition: background-color 0.3s ease, border-color 0.3s ease, color 0.3s ease; flex-shrink: 0; }
#note-detail-actions { margin-top: auto; padding-top: 20px; flex-shrink: 0; }
#note-detail-actions button { margin-right: 10px; margin-top: 10px; }
.pin-button { background: none; border: none; padding: 5px; cursor: pointer; color: var(--text-secondary); transition: color 0.2s ease, transform 0.2s ease; position: absolute; top: 25px; right: 20px; }
.pin-button svg { width: 20px; height: 20px; vertical-align: middle; }
.pin-button:hover { color: var(--text-primary); transform: scale(1.1); }
.pin-button.pinned { color: var(--accent-color); }
.note-item .pin-icon { position: absolute; top: 10px; right: 10px; font-size: 1.2em; color: var(--text-secondary); cursor: pointer; z-index: 5; padding: 3px; }
.note-item .pin-icon.pinned { color: var(--accent-color); }
.note-item .pin-icon:hover { color: var(--text-primary); }
#note-editor-view { max-width: 800px; }
#note-editor-view h2 { border-bottom: 1px solid var(--border-secondary); padding-bottom: 15px; margin-bottom: 20px; color: var(--text-primary); flex-shrink: 0; }
#note-editor-view textarea#note-content-input { font-family: var(--font-content); flex-grow: 1; }
.tag-input-container { position: relative; margin-bottom: 12px; flex-shrink: 0; }
#note-tags-input { margin-bottom: 0; }
.tag-suggestions-list { position: absolute; top: 100%; left: 0; right: 0; background-color: var(--bg-secondary); border: 1px solid var(--border-input); border-top: none; border-radius: 0 0 6px 6px; max-height: 150px; overflow-y: auto; z-index: 100; box-shadow: 0 4px 8px var(--shadow-primary); }
.suggestion-item { padding: 8px 12px; cursor: pointer; font-size: 0.9em; color: var(--text-primary); border-bottom: 1px solid var(--border-secondary); }
.suggestion-item:last-child { border-bottom: none; }
.suggestion-item:hover { background-color: var(--bg-note-item-hover); }
.suggestion-item.active { background-color: var(--accent-color); color: var(--text-button); }
.code-options { margin-top: 15px; margin-bottom: 20px; display: flex; align-items: center; flex-wrap: wrap; flex-shrink: 0; }
.code-options label { margin-left: 8px; margin-right: 20px; cursor: pointer; user-select: none; color: var(--text-secondary); }
.code-options input[type="checkbox"] { width: auto; margin-bottom: 0; cursor: pointer; vertical-align: middle; }
.code-options select { width: auto; min-width: 150px; margin-bottom: 0; vertical-align: middle; }
.editor-actions { margin-top: auto; padding-top: 20px; flex-shrink: 0; }
.editor-actions button { margin-right: 10px; margin-top: 10px; }
#scrollToTopBtn { display: none; position: fixed; bottom: 20px; right: 30px; z-index: 99; border: none; outline: none; background-color: var(--bg-button-primary); color: var(--text-button); cursor: pointer; padding: 10px 15px; border-radius: 50%; font-size: 18px; line-height: 1; box-shadow: 0 2px 5px var(--shadow-primary); opacity: 0.8; transition: opacity 0.3s ease, background-color 0.3s ease, transform 0.2s ease; }
#scrollToTopBtn:hover { background-color: var(--bg-button-primary-hover); opacity: 1; }
#scrollToTopBtn:active { transform: scale(0.95); }
.search-highlight { background-color: var(--highlight-bg); font-weight: bold; color: var(--text-highlight); border-radius: 2px; }
.sidebar-settings { margin-top: auto; padding-top: 15px; }
.sidebar .sidebar-settings h2 { border-bottom: 1px solid var(--border-secondary); padding-bottom: 5px; }
.theme-selector, .accent-color-selector, .font-selector { margin-bottom: 15px; }
.theme-selector h3, .accent-color-selector h3, .font-selector h3 { font-size: 0.95em; margin-bottom: 10px; padding-bottom: 0; color: var(--text-secondary); font-weight: 500; border-bottom: none; }
.theme-options { display: flex; gap: 8px; flex-wrap: wrap; }
.theme-button { flex: 1; min-width: 55px; padding: 6px 8px; font-size: 0.85em; border: 1px solid var(--border-primary); background-color: var(--bg-secondary); color: var(--text-secondary); transition: background-color 0.2s ease, color 0.2s ease, border-color 0.2s ease; }
.theme-button.active { background-color: var(--bg-button-primary); color: var(--text-button); border-color: var(--bg-button-primary); font-weight: bold; }
.theme-button:not(.active):hover { background-color: var(--bg-note-item-hover); border-color: var(--border-input); color: var(--text-primary); }
.accent-color-options { display: flex; flex-wrap: wrap; gap: 8px; }
.accent-color-button { width: 28px; height: 28px; border-radius: 50%; border: 2px solid var(--bg-sidebar); padding: 0; box-shadow: 0 1px 3px rgba(0,0,0,0.1); transition: transform 0.1s ease, box-shadow 0.2s ease; }
.accent-color-button:hover { transform: scale(1.1); box-shadow: 0 2px 5px rgba(0,0,0,0.2); }
.accent-color-button.active { border-color: var(--text-primary); box-shadow: 0 0 0 2px var(--bg-sidebar), 0 0 0 4px var(--text-primary); transform: scale(1.1); }
.font-selector select { width: 100%; padding: 8px 10px; font-size: 0.9em; }

#note-editor-todos-container { border: 1px solid var(--border-secondary); border-radius: 6px; padding: 15px; margin-top: 20px; background-color: var(--bg-content-display); flex-shrink: 0; }
#note-editor-todos-container h3 { font-size: 1.1em; margin-top: 0; margin-bottom: 15px; color: var(--text-primary); display: flex; justify-content: space-between; align-items: center; }
#note-editor-todos-container h3 label { font-size: 0.9em; font-weight: normal; color: var(--text-secondary); cursor: pointer; display: flex; align-items: center; }
#note-editor-todos-container h3 input[type="checkbox"] { margin-left: 8px; width: auto; vertical-align: middle; }
#note-editor-todos-list { list-style: none; padding-left: 0; margin-bottom: 10px; }
.todo-editor-item { display: flex; flex-direction: column; padding: 10px 0; border-bottom: 1px dashed var(--border-secondary); }
.todo-editor-item:last-child { border-bottom: none; }
.todo-editor-item-main { display: flex; align-items: center; width: 100%; margin-bottom: 8px; }
.todo-editor-item-checkbox { width: auto; margin-right: 10px; flex-shrink: 0; opacity: 0.6; }
.todo-editor-item-text { flex-grow: 1; border: 1px solid var(--border-input); padding: 8px 10px; border-radius: 4px; font-size: 0.95em; background-color: var(--bg-input); color: var(--text-primary); }
.todo-editor-item-text:focus { outline: none; border-color: var(--border-input-focus); box-shadow: 0 0 0 2px var(--shadow-focus); }
.todo-editor-item-meta { display: flex; align-items: center; gap: 10px; width: 100%; padding-left: 28px; flex-wrap: wrap; }
.todo-editor-item-priority, .todo-editor-item-deadline { padding: 6px 8px; border: 1px solid var(--border-input); border-radius: 4px; font-size: 0.85em; background-color: var(--bg-input); color: var(--text-primary); margin-bottom: 5px; }
.todo-editor-item-priority { min-width: 150px; }
.todo-editor-item-deadline { min-width: 120px; }
.todo-editor-item-delete-btn { padding: 6px 10px; font-size: 0.85em; margin-left: auto; background-color: var(--bg-button-danger); color: var(--text-button); border: none; border-radius: 4px; cursor: pointer; transition: background-color 0.2s ease; margin-bottom: 5px; }
.todo-editor-item-delete-btn:hover { background-color: var(--bg-button-danger-hover); }
#add-todo-editor-item-btn { margin-top: 10px; font-size: 0.9em; padding: 8px 12px; }
#note-editor-todos-list, #add-todo-editor-item-btn { display: none; }
#note-detail-todos-container { margin-top: 25px; padding-top: 20px; border-top: 1px solid var(--border-secondary); flex-shrink: 0; }
#note-detail-todos-container h3 { font-size: 1.3em; margin-bottom: 15px; color: var(--text-primary); }
#note-detail-todos-list { list-style: none; padding-left: 0; display: flex; flex-direction: column; gap: 10px; }
.todo-detail-item { display: flex; align-items: flex-start; padding: 12px 15px; font-size: 1em; color: var(--text-primary); background-color: var(--bg-secondary); border: 1px solid var(--border-primary); border-radius: 6px; box-shadow: 0 1px 2px rgba(0,0,0,0.05); }
.todo-detail-item-checkbox { width: auto; margin-right: 12px; margin-top: 4px; flex-shrink: 0; cursor: pointer; transform: scale(1.2); }
.todo-detail-item-content { display: flex; flex-direction: column; flex-grow: 1; gap: 5px; }
.todo-detail-item-text { transition: color 0.3s ease; word-break: break-word; line-height: 1.5; }
.todo-detail-item-text.completed { text-decoration: line-through; color: var(--text-secondary); opacity: 0.7; }
.todo-detail-item-meta-display { display: flex; align-items: center; gap: 12px; font-size: 0.8em; color: var(--text-secondary); margin-top: 4px; flex-wrap: wrap; }
.todo-detail-item-priority, .todo-detail-item-deadline { display: inline-flex; align-items: center; gap: 4px; padding: 3px 7px; border-radius: 4px; font-weight: 500; }
.todo-detail-item-priority.priority-high { background-color: #ffe3e3; color: #c00; border: 1px solid #f5c6cb; }
.todo-detail-item-priority.priority-medium { background-color: #fff3cd; color: #856404; border: 1px solid #ffeeba; }
.todo-detail-item-priority.priority-low { background-color: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
.todo-detail-item-deadline { background-color: var(--bg-content-display); border: 1px solid var(--border-secondary); }
.todo-detail-item-deadline.overdue { background-color: #ffe3e3; color: #c00; border-color: #f5c6cb; font-weight: bold; }
#note-detail-todos-progress { margin-top: 20px; font-size: 0.95em; color: var(--text-secondary); background-color: var(--bg-content-display); padding: 10px 15px; border-radius: 6px; border: 1px solid var(--border-content-display); flex-shrink: 0; }
#note-detail-todos-progress .progress-bar-container { width: 100%; height: 12px; background-color: var(--border-secondary); border-radius: 6px; overflow: hidden; margin-top: 8px; }
#note-detail-todos-progress .progress-bar { height: 100%; width: 0%; background-color: var(--accent-color); border-radius: 6px; transition: width 0.3s ease; }
.event-date-input-container { margin-top: 15px; margin-bottom: 15px; flex-shrink: 0; }
.event-date-input-container label { display: block; margin-bottom: 5px; font-size: 0.9em; color: var(--text-secondary); font-weight: 500; }
#note-event-date { width: auto; min-width: 180px; padding: 10px 12px; margin-bottom: 0; }
.note-item-content-preview .todo-preview-summary { display: block; font-weight: 500; margin-bottom: 5px; font-size: 0.9em; color: var(--text-secondary); }
.note-item-content-preview .todo-preview-item { display: flex; align-items: flex-start; margin-bottom: 3px; font-size: 0.9em; line-height: 1.35; }
.note-item-content-preview .todo-preview-item .todo-status { width: auto; margin-right: 6px; font-family: monospace; flex-shrink: 0; line-height: inherit; }
.note-item-content-preview .todo-preview-item .todo-text { word-break: break-word; line-height: inherit; flex-grow: 1; }
.note-item-content-preview .todo-preview-item .todo-meta-preview { margin-left: 8px; font-size: 0.85em; opacity: 0.85; white-space: nowrap; flex-shrink: 0; line-height: inherit; }
.note-item-content-preview .todo-preview-item .todo-priority-preview { font-weight: bold; padding: 1px 4px; border-radius: 3px; margin-right: 5px; }
.note-item-content-preview .todo-preview-item .priority-high { color: #c00; background-color: #ffe3e380; }
.note-item-content-preview .todo-preview-item .priority-low { color: #155724; background-color: #d4edda80; }
.note-item-content-preview .todo-preview-item .todo-deadline-preview.overdue { color: var(--text-error); font-weight: bold; }

body.logged-out .logged-in-element { display: none !important; }
body.logged-in .logged-out-element { display: none !important; }
#welcome-message .auth-link { color: var(--text-link); text-decoration: underline; cursor: pointer; transition: color 0.2s ease; }
#welcome-message .auth-link:hover { color: var(--text-link-hover); }
.modal-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.6); z-index: 1000; opacity: 0; transition: opacity 0.3s ease; }
.modal { display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -60%); background-color: var(--bg-secondary); padding: 30px 40px; border-radius: 8px; box-shadow: 0 5px 20px rgba(0,0,0,0.2); z-index: 1001; width: 90%; max-width: 450px; opacity: 0; transition: opacity 0.3s ease, transform 0.3s ease; }
body.modal-open .modal-overlay { display: block; opacity: 1; }
body.modal-open .modal { display: block; opacity: 1; transform: translate(-50%, -50%); }
.modal-close-btn { position: absolute; top: 10px; right: 15px; background: none; border: none; font-size: 2em; line-height: 1; color: var(--text-secondary); cursor: pointer; padding: 0; transition: color 0.2s ease; }
.modal-close-btn:hover { color: var(--text-primary); }
#auth-modal-content h2 { margin-top: 0; margin-bottom: 20px; text-align: center; font-size: 1.5em; color: var(--text-primary); }
#auth-modal #login-form, #auth-modal #signup-form { text-align: center; }
#auth-modal input[type="email"], #auth-modal input[type="password"] { margin-bottom: 15px; }
#auth-modal button[type="submit"] { margin-top: 10px; width: 100%; }
#auth-modal .error-message { min-height: 1.2em; margin-top: 10px; margin-bottom: 5px; }
#auth-modal .auth-switch-link { margin-top: 25px; font-size: 0.9em; }
#auth-modal .auth-switch-link span { color: var(--text-link); text-decoration: underline; cursor: pointer; }
#auth-modal .auth-switch-link span:hover { color: var(--text-link-hover); }

.mobile-menu-button { display: none; background: none; border: none; color: var(--text-header); padding: 8px; margin-right: 10px; cursor: pointer; }
#sidebar-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.5); z-index: 998; opacity: 0; transition: opacity 0.3s ease; }

#calendar-view { padding-top: 15px; }
#calendar-view h2 { margin-bottom: 20px; font-size: 1.6em; color: var(--text-primary); padding-bottom: 10px; flex-shrink: 0; }
#calendar-container { margin-bottom: 20px; position: relative; min-height: 500px; }
.calendar-view-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; padding-bottom: 10px; border-bottom: 1px solid var(--border-secondary); flex-wrap: wrap; gap: 15px; flex-shrink: 0; }
.calendar-view-header h2 { margin-bottom: 0; border-bottom: none; padding-bottom: 0; }

.fc .fc-button { background-color: var(--bg-button-secondary); border-color: var(--bg-button-secondary); color: var(--text-button); padding: 6px 12px; font-size: 0.9em; border-radius: 6px; transition: background-color 0.2s ease, border-color 0.2s ease; box-shadow: none; text-transform: none; }
.fc .fc-button:hover { background-color: var(--bg-button-secondary-hover); border-color: var(--bg-button-secondary-hover); }
.fc .fc-button:focus { box-shadow: 0 0 0 3px var(--shadow-focus); }
.fc .fc-button-primary { background-color: var(--bg-button-primary); border-color: var(--bg-button-primary); }
.fc .fc-button-primary:hover { background-color: var(--bg-button-primary-hover); border-color: var(--bg-button-primary-hover); }
.fc .fc-button-primary:disabled { background-color: var(--bg-button-secondary); border-color: var(--bg-button-secondary); opacity: 0.7; }
.fc .fc-toolbar-title { font-size: 1.4em; color: var(--text-primary); }
.fc-direction-ltr .fc-daygrid-event.fc-event-start, .fc-direction-rtl .fc-daygrid-event.fc-event-end, .fc-daygrid-event { padding: 2px 5px; border-radius: 4px; font-size: 0.85em; margin-bottom: 3px; border-width: 1px; }
.fc-daygrid-event:not([style*="background-color"]) { background-color: var(--accent-color); border-color: var(--accent-color); color: var(--text-button); }
.fc-daygrid-event[style*="background-color: rgb(111, 66, 193)"] { color: white; }
.fc-daygrid-event[style*="background-color: rgb(220, 53, 69)"] { color: white; }
.fc-daygrid-event[style*="background-color: rgb(25, 135, 84)"] { color: white; }
.fc-daygrid-event[style*="background-color: rgb(108, 117, 125)"] { color: white; opacity: 0.7; }
.fc-daygrid-event[style*="background-color: rgb(139, 0, 0)"] { color: white; }
.fc-event-title { color: inherit; font-weight: 500; }
.fc .fc-daygrid-day.fc-day-today { background-color: rgba(0, 123, 255, 0.08); }

.fab { position: fixed; bottom: 90px; right: 30px; z-index: 98; width: 56px; height: 56px; border-radius: 50%; display: flex; align-items: center; justify-content: center; box-shadow: 0 4px 12px rgba(0,0,0,0.2); padding: 0; }
.fab svg { width: 24px; height: 24px; }
#scrollToTopBtn { bottom: 20px; right: 30px; }

@media (max-width: 992px) {
    #notes-list-container, #trash-list-container { grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); gap: 15px; }
    .content-area { padding: 25px; }
}

@media (max-width: 768px) {
    body { font-size: 15px; }
    #app-container { min-height: 100vh; height: auto; }
    .main-content { flex-direction: column; position: relative; overflow: visible; }
    .sidebar { position: fixed; top: var(--header-height-mobile); left: 0; height: calc(100vh - var(--header-height-mobile)); width: 280px; max-width: 85%; transform: translateX(-100%); transition: transform 0.3s ease; z-index: 999; border-right: 1px solid var(--border-primary); border-bottom: none; overflow-y: auto; box-shadow: 2px 0 10px rgba(0,0,0,0.1); background-color: var(--bg-sidebar); }
    body.sidebar-open .sidebar { transform: translateX(0); }
    body.sidebar-open #sidebar-overlay { display: block; opacity: 1; }
    .content-area { width: 100%; padding: 15px; overflow-y: auto; flex-grow: 1; }
    #notes-list-container, #trash-list-container { grid-template-columns: repeat(auto-fill, minmax(100%, 1fr)); gap: 15px; }
    #notes-grid-view h2, #trash-view h2, #calendar-view h2 { font-size: 1.4em; flex-shrink: 0; margin-bottom: 10px; padding-bottom: 8px; }
    .grid-view-header, .calendar-view-header { flex-direction: column; align-items: flex-start; flex-shrink: 0; margin-bottom: 10px; padding-bottom: 10px; }
    .calendar-view-header { flex-direction: row; justify-content: space-between; align-items: center; }
    .calendar-view-header h2 { margin-bottom: 0; }

    .sort-options { width: 100%; margin-top: 8px; flex-direction: column; align-items: stretch; gap: 10px; }
    .sort-options select { flex-grow: 1; min-width: 0; width: 100%; padding: 6px 10px; font-size: 0.85em; }

    .modal { padding: 25px 20px; width: 90%; }
    #auth-modal-content h2 { font-size: 1.3em; }
    #note-detail-view h2 { font-size: 1.5em; }
    .content-display, #note-detail-code { font-size: 0.9em; padding: 15px; }
    .back-button { margin-bottom: 15px; }
    #scrollToTopBtn { bottom: 15px; right: 15px; padding: 8px 12px; font-size: 16px; }
    .pin-button { top: 15px; right: 15px; }
    .pin-button svg { width: 18px; height: 18px; }
    .tag-suggestions-list { font-size: 0.9em; }
    #calendar-view { padding-top: 10px; }
    #calendar-container { position: relative; min-height: 450px; margin-bottom: 20px; }
    .fc .fc-toolbar.fc-header-toolbar { flex-direction: column; gap: 8px; margin-bottom: 10px; padding: 0 5px; align-items: stretch; }
    .fc .fc-toolbar-chunk { display: flex; justify-content: space-between; }
    .fc .fc-toolbar-title { font-size: 1.1em; text-align: center; margin: 5px 0; }
    .fc .fc-button { padding: 5px 8px; font-size: 0.8em; }
    .app-header { justify-content: flex-start; padding: 8px 12px; height: var(--header-height-mobile); line-height: calc(var(--header-height-mobile) - 16px); }
    .mobile-menu-button { display: block; padding: 4px; align-self: center; }
    .app-header h1 { margin-left: 8px; font-size: 1.2em; line-height: normal; align-self: center; }
    .user-info { margin-left: auto; align-self: center; }
    .user-info span#user-email { display: none !important; }
    .user-info button { padding: 5px 8px; font-size: 0.85em; }

    /* Urgent Task Banner Mobile Styles */
    #urgent-task-banner { /* ID selector takes precedence */
        padding: 10px 12px;
        font-size: 0.85em; /* Font chung cho banner trên mobile */
        margin-bottom: 15px;
    }
    .urgent-task-banner-title {
        font-size: 0.95em; /* So với font-size của #urgent-task-banner */
    }
    .urgent-task-banner-title svg {
        width: 16px;
        height: 16px;
    }
    .urgent-task-banner-line2 {
        font-size: 0.9em; /* So với font-size của #urgent-task-banner trên mobile */
        gap: 3px 10px;
    }
    .urgent-task-banner-line2 > span { margin-right: 10px; display: inline-block; margin-bottom: 3px; }
    .urgent-task-banner-line2 > span:last-child { margin-right: 0; }


    .fab { bottom: 75px; right: 15px; width: 50px; height: 50px; }
    .fab svg { width: 20px; height: 20px; }
    #scrollToTopBtn { bottom: 15px; right: 15px; }
}

/* CSS CHO PANEL BỘ LỌC LỊCH */
#toggle-calendar-filters-btn { padding: 8px 12px; font-size: 0.9em; }
#toggle-calendar-filters-btn svg { margin-right: 6px; vertical-align: middle; }
.calendar-filters-collapsible { background-color: var(--bg-secondary); padding: 15px; border: 1px solid var(--border-primary); border-radius: 6px; margin-top: 10px; margin-bottom: 20px; box-shadow: 0 2px 5px var(--shadow-primary); }
.calendar-filter-options-inner div { margin-bottom: 12px; }
.calendar-filter-options-inner div:last-child { margin-bottom: 0; }
.calendar-filter-options-inner label { display: block; margin-bottom: 5px; font-weight: 500; font-size: 0.9em; color: var(--text-secondary); }
.calendar-filter-options-inner select { width: 100%; padding: 8px 10px; font-size: 0.9em; margin-bottom: 0; }
.calendar-filters-actions { margin-top: 15px; display: flex; gap: 10px; justify-content: flex-end; }
.calendar-filters-actions button { padding: 8px 15px; font-size: 0.9em; }

@media (max-width: 768px) {
    .calendar-view-header { flex-direction: row; justify-content: space-between; align-items: center; margin-bottom: 10px; }
    #toggle-calendar-filters-btn { font-size: 0.85em; padding: 6px 10px; }
    .calendar-filters-collapsible { padding: 12px; margin-top: 10px; }
    .calendar-filter-options-inner label { font-size: 0.85em; }
    .calendar-filter-options-inner select { font-size: 0.85em; padding: 6px 8px; }
    .calendar-filters-actions button { font-size: 0.85em; padding: 6px 12px; }
}

/* CSS CHO HIỆU ỨNG BANNER VIỆC GẤP */
#urgent-task-banner {
    background-color: var(--bg-urgent-banner);
    border: 1px solid var(--border-urgent-banner);
    color: var(--text-urgent-banner-content);
    border-radius: 6px;
    padding: 12px 15px;
    margin-bottom: 20px;
    box-shadow: 0 3px 6px rgba(0,0,0,0.08);
}

.urgent-task-banner-title {
    font-weight: bold;
    color: #dc3545; /* Màu đỏ cho chữ "VIỆC GẤP:" và icon SVG (do fill="currentColor") */
    font-size: 1em; /* So với font-size của #urgent-task-banner */
    margin-bottom: 5px;
    display: flex;
    align-items: center;
}
.urgent-task-banner-title svg {
    width: 18px;
    height: 18px;
    margin-right: 8px;
    /* fill: #ffc107; */ /* Bỏ comment nếu muốn icon vàng cố định, và text "VIỆC GẤP" vẫn đỏ. */
                      /* Nếu làm vậy, cần bọc text "VIỆC GẤP" vào span riêng để nó có màu đỏ riêng. */
}

.urgent-task-banner-content {
    display: block;
    margin-bottom: 8px;
    color: var(--text-urgent-banner-content); /* Đảm bảo màu chữ nội dung dễ đọc trên nền banner */
}

.urgent-task-banner-line2 {
    display: flex;
    flex-wrap: wrap;
    gap: 5px 15px;
    align-items: center;
    margin-top: 5px;
    font-size: 0.9em; /* Chữ ở dòng 2 nhỏ hơn một chút */
    color: var(--text-urgent-banner-content); /* Màu chữ mặc định cho dòng 2 */
}

.urgent-task-deadline .deadline-status {
    font-weight: bold;
    margin-left: 5px;
}
.urgent-task-deadline .deadline-status.overdue {
    color: #e53935; /* Màu đỏ đậm hơn */
}
.urgent-task-deadline .deadline-status.today {
    color: var(--accent-color); /* Màu nhấn chính */
}
.urgent-task-deadline .deadline-status.tomorrow {
    color: #fb8c00; /* Màu cam đậm hơn */
}
.urgent-task-deadline .deadline-status.upcoming {
    color: var(--text-secondary); /* Kế thừa màu chữ phụ nếu không có màu banner riêng */
}

.urgent-task-priority-banner {
    font-weight: bold;
    margin-left: 5px;
}
.urgent-task-priority-banner.priority-high {
    color: #e53935; /* Màu đỏ đậm */
}
.urgent-task-priority-banner.priority-medium {
    color: var(--text-urgent-banner-content); /* Màu chữ chung của banner */
    font-weight: normal;
}
.urgent-task-priority-banner.priority-low {
    color: #43a047; /* Màu xanh lá đậm */
}

.urgent-task-note-link-container{
    margin-left: 5px;
    color: var(--text-urgent-banner-content); /* Cho chữ "(Note: " */
}
.urgent-task-note-link {
    color: var(--text-link);
    text-decoration: underline;
    cursor: pointer;
    transition: color 0.2s ease;
}
.urgent-task-note-link:hover {
    color: var(--text-link-hover);
}

/* Responsive cho Banner Việc Gấp (CSS gốc của bạn đã có, chỉ review lại) */
@media (max-width: 768px) {
    #urgent-task-banner {
        padding: 10px 12px; /* Giữ nguyên */
        font-size: 0.85em;  /* Giữ nguyên */
        margin-bottom: 15px; /* Giữ nguyên */
    }
    .urgent-task-banner-title {
        font-size: 0.95em; /* Giữ nguyên */
    }
    .urgent-task-banner-title svg {
        width: 16px; /* Giữ nguyên */
        height: 16px; /* Giữ nguyên */
    }
    .urgent-task-banner-line2 {
        font-size: 0.9em; /* Giữ nguyên hoặc 0.85em nếu muốn nhỏ hơn nữa */
        gap: 3px 10px; /* Giữ nguyên */
    }
     /* Các mục con của line2 trên mobile đã có style display:inline-block và margin-right từ trước */
}
