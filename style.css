/* --- Biến màu --- */
:root {
    /* Màu cơ bản & Giao diện */
    --bg-color: #f4f7f6;
    --text-color: #333;
    --card-bg-color: #ffffff;
    --border-color: #e0e0e0;
    --primary-color: #007bff; /* Màu nhấn - Sẽ được cập nhật bởi JS */
    --primary-text-color: #ffffff; /* Màu chữ trên nền màu nhấn */
    --secondary-color: #6c757d; /* Màu phụ (vd: timestamp, nút thường) */
    --danger-color: #dc3545; /* Màu cảnh báo/xóa */
    --success-color: #198754; /* Màu thành công/khôi phục */
    --input-bg-color: #ffffff;
    --input-border-color: #ced4da;
    --shadow-color: rgba(0, 0, 0, 0.08);
    --shadow-hover-color: rgba(0, 0, 0, 0.12);
    --fab-bg-color: var(--primary-color);
    --fab-text-color: var(--primary-text-color);
    --tag-bg-color: #e9ecef;
    --tag-text-color: #495057;
    --pin-color: var(--secondary-color);
    --pinned-color: #ffc107;
    --highlight-bg-color: #fff3cd;
    --highlight-text-color: #664d03;
    --archive-color: var(--secondary-color);
    --fade-color-start: rgba(255, 255, 255, 0);
    --fade-color-end: rgba(255, 255, 255, 1);
    --modal-backdrop-color: rgba(0, 0, 0, 0.6);
    --modal-content-bg: #ffffff;
    --modal-border-color: #ccc;

    /* Tab variables */
    --tab-bg: #f8f9fa; /* Nền nhẹ cho tab không active */
    --tab-text: var(--secondary-color);
    --tab-border-color: var(--border-color);
    --tab-hover-bg: #e9ecef; /* Nền rõ hơn khi hover */
    --tab-hover-text: var(--primary-color);
    --tab-active-bg: var(--card-bg-color); /* Nền giống card */
    --tab-active-border: var(--primary-color);
    --tab-active-text: var(--primary-color);
    --tab-radius: 6px 6px 0 0;

    /* Dog-ear variables */
    --dog-ear-size: 20px;
    --dog-ear-bg: var(--bg-color);
    --dog-ear-shadow: rgba(0, 0, 0, 0.1);

    /* Noise texture */
    --noise-opacity: 0.03;
    --noise-url: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='100' height='100' viewBox='0 0 100 100'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%' height='100%' filter='url(%23noiseFilter)' opacity='1'/%3E%3C/svg%3E");

    /* NEW: Move Note Menu */
    --move-menu-bg: var(--card-bg-color);
    --move-menu-border: var(--border-color);
    --move-menu-shadow: var(--shadow-hover-color);
    --move-menu-item-hover-bg: var(--tab-hover-bg);


    /* Biến cho Font & Layout */
    --content-font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
    --font-size-scale: 1;
    --note-gap: 20px;

    /* Biến cho Cài đặt Giao diện */
    --setting-section-bg: rgba(0, 0, 0, 0.02);
    --setting-option-border: var(--border-color);
    --setting-option-hover-bg: rgba(0, 0, 0, 0.05);
    --setting-option-active-bg: var(--primary-color);
    --setting-option-active-text: var(--primary-text-color);
    --setting-option-active-border: var(--primary-color);

    /* Note Color Variables (Light Mode) */
    --note-color-yellow-bg: #fff9e0; --note-color-yellow-border: #ffecb3;
    --note-color-blue-bg: #e7f3ff; --note-color-blue-border: #bbdefb;
    --note-color-green-bg: #e8f5e9; --note-color-green-border: #c8e6c9;
    --note-color-red-bg: #ffebee; --note-color-red-border: #ffcdd2;
    --note-color-purple-bg: #f3e5f5; --note-color-purple-border: #e1bee7;
    --note-color-grey-bg: #f5f5f5; --note-color-grey-border: #e0e0e0;
}

/* ==================== DARK MODE ==================== */
body.dark-mode {
     --bg-color: #212529;
     --text-color: #dee2e6;
     --card-bg-color: #343a40;
     --border-color: #495057;
     --primary-text-color: #ffffff;
     --secondary-color: #adb5bd;
     --danger-color: #f84d5e;
     --success-color: #20c997;
     --input-bg-color: #495057;
     --input-border-color: #6c757d;
     --shadow-color: rgba(0, 0, 0, 0.25);
     --shadow-hover-color: rgba(0, 0, 0, 0.35);
     --tag-bg-color: #495057;
     --tag-text-color: #dee2e6;
     --pin-color: var(--secondary-color);
     --pinned-color: #FFD700;
     --highlight-bg-color: #a08a00;
     --highlight-text-color: #fff;
     --archive-color: var(--secondary-color);
     --fade-color-start: rgba(52, 58, 64, 0);
     --fade-color-end: rgba(52, 58, 64, 1);
     --modal-backdrop-color: rgba(0, 0, 0, 0.7);
     --modal-content-bg: #343a40;
     --modal-border-color: #495057;

     /* Tab variables for Dark Mode */
     --tab-bg: #2c3034; /* Nền tối nhẹ cho tab không active */
     --tab-text: var(--secondary-color);
     --tab-border-color: var(--border-color);
     --tab-hover-bg: #495057; /* Nền rõ hơn khi hover */
     --tab-hover-text: #e9ecef;
     --tab-active-bg: var(--card-bg-color);
     --tab-active-border: var(--primary-color);
     --tab-active-text: var(--primary-color);

     /* Dog-ear variables for Dark Mode */
     --dog-ear-bg: var(--bg-color);
     --dog-ear-shadow: rgba(0, 0, 0, 0.3);

     /* Noise texture for Dark Mode */
     --noise-opacity: 0.04;

     /* NEW: Move Note Menu Dark */
     --move-menu-bg: var(--modal-content-bg);
     --move-menu-border: var(--modal-border-color);
     --move-menu-shadow: var(--shadow-hover-color);
     --move-menu-item-hover-bg: var(--tab-hover-bg);

    /* Biến Cài đặt Dark Mode */
    --setting-section-bg: rgba(255, 255, 255, 0.04);
    --setting-option-border: var(--border-color);
    --setting-option-hover-bg: rgba(255, 255, 255, 0.1);

    /* Note Color Variables (Dark Mode) */
    --note-color-yellow-bg: #4d4222; --note-color-yellow-border: #806b38;
    --note-color-blue-bg: #2c3e50; --note-color-blue-border: #5dade2;
    --note-color-green-bg: #2e4b30; --note-color-green-border: #58d68d;
    --note-color-red-bg: #5c2b2e; --note-color-red-border: #ec7063;
    --note-color-purple-bg: #4a235a; --note-color-purple-border: #bb8fce;
    --note-color-grey-bg: #424242; --note-color-grey-border: #757575;
}

/* ==================== CÁC THEME KHÁC (Định nghĩa biến) ==================== */
/* (Giữ nguyên các theme khác) */
body.theme-sepia {
    --bg-color: #f4ecd8;
    --text-color: #5b4636;
    --card-bg-color: #fbf5e9;
    --border-color: #dcd0ba;
    --primary-text-color: #ffffff;
    --secondary-color: #a1887f;
    --danger-color: #c62828;
    --success-color: #558b2f;
    --input-bg-color: #fbf5e9;
    --input-border-color: #dcd0ba;
    --shadow-color: rgba(91, 70, 54, 0.1);
    --shadow-hover-color: rgba(91, 70, 54, 0.15);
    --tag-bg-color: #e5dace;
    --tag-text-color: #795548;
    --pin-color: var(--secondary-color);
    --pinned-color: #bcaaa4;
    --highlight-bg-color: #efebe9;
    --highlight-text-color: #3e2723;
    --fade-color-start: rgba(251, 245, 233, 0);
    --fade-color-end: rgba(251, 245, 233, 1);
    --modal-backdrop-color: rgba(91, 70, 54, 0.6);
    --modal-content-bg: #fbf5e9;
    --modal-border-color: #dcd0ba;

    /* Tab variables for Sepia */
    --tab-bg: #fdfaf3;
    --tab-text: var(--secondary-color);
    --tab-border-color: var(--border-color);
    --tab-hover-bg: #efebe9;
    --tab-hover-text: var(--primary-color);
    --tab-active-bg: var(--card-bg-color);
    --tab-active-border: var(--primary-color);
    --tab-active-text: var(--primary-color);

    /* Dog-ear variables for Sepia */
    --dog-ear-bg: var(--bg-color);
    --dog-ear-shadow: rgba(91, 70, 54, 0.1);

    /* Noise texture for Sepia */
     --noise-opacity: 0.05;

     /* NEW: Move Note Menu Sepia */
     --move-menu-bg: var(--modal-content-bg);
     --move-menu-border: var(--modal-border-color);
     --move-menu-shadow: var(--shadow-hover-color);
     --move-menu-item-hover-bg: var(--tab-hover-bg);

    --setting-section-bg: rgba(91, 70, 54, 0.05);
    --setting-option-hover-bg: rgba(91, 70, 54, 0.1);

    /* Note Colors Sepia */
    --note-color-yellow-bg: #f9f3d6; --note-color-yellow-border: #d7ccc8;
    --note-color-blue-bg: #e8eaf6; --note-color-blue-border: #b0bec5;
    --note-color-green-bg: #e8f5e9; --note-color-green-border: #a5d6a7;
    --note-color-red-bg: #ffebee; --note-color-red-border: #ef9a9a;
    --note-color-purple-bg: #f3e5f5; --note-color-purple-border: #ce93d8;
    --note-color-grey-bg: #f5f5f5; --note-color-grey-border: #dcd0ba;
}

body.theme-solarized-light {
    --bg-color: #fdf6e3; /* base3 */
    --text-color: #657b83; /* base00 */
    --card-bg-color: #eee8d5; /* base2 */
    --border-color: #93a1a1; /* base01 */
    --primary-text-color: #fdf6e3; /* base3 */
    --secondary-color: #839496; /* base0 */
    --danger-color: #dc322f; /* red */
    --success-color: #859900; /* green */
    --input-bg-color: #eee8d5;
    --input-border-color: #93a1a1;
    --shadow-color: rgba(88, 110, 117, 0.1);
    --shadow-hover-color: rgba(88, 110, 117, 0.15);
    --tag-bg-color: #eee8d5;
    --tag-text-color: #586e75; /* base01 */
    --pin-color: var(--secondary-color);
    --pinned-color: #b58900; /* yellow */
    --highlight-bg-color: #eee8d5;
    --highlight-text-color: #cb4b16; /* orange */
    --fade-color-start: rgba(238, 232, 213, 0);
    --fade-color-end: rgba(238, 232, 213, 1);
    --modal-backdrop-color: rgba(238, 232, 213, 0.6);
    --modal-content-bg: #fdf6e3; /* base3 */
    --modal-border-color: #eee8d5; /* base2 */

    /* Tab variables for Solarized Light */
    --tab-bg: #f5efdc;
    --tab-text: var(--secondary-color);
    --tab-border-color: var(--border-color);
    --tab-hover-bg: #eee8d5;
    --tab-hover-text: #586e75; /* base01 */
    --tab-active-bg: var(--card-bg-color);
    --tab-active-border: var(--primary-color);
    --tab-active-text: var(--primary-color);

    /* Dog-ear variables for Solarized Light */
    --dog-ear-bg: var(--bg-color);
    --dog-ear-shadow: rgba(88, 110, 117, 0.1);

    /* Noise texture for Solarized Light */
     --noise-opacity: 0.03;

     /* NEW: Move Note Menu Solarized Light */
     --move-menu-bg: var(--modal-content-bg);
     --move-menu-border: var(--modal-border-color);
     --move-menu-shadow: var(--shadow-hover-color);
     --move-menu-item-hover-bg: var(--tab-hover-bg);

    --setting-section-bg: rgba(0, 43, 54, 0.03);
    --setting-option-hover-bg: rgba(0, 43, 54, 0.07);

     /* Note Colors Solarized Light */
    --note-color-yellow-bg: #fcf4b3; --note-color-yellow-border: #b58900;
    --note-color-blue-bg: #dfefff; --note-color-blue-border: #268bd2;
    --note-color-green-bg: #edf8d7; --note-color-green-border: #859900;
    --note-color-red-bg: #ffe4e1; --note-color-red-border: #dc322f;
    --note-color-purple-bg: #efebff; --note-color-purple-border: #6c71c4;
    --note-color-grey-bg: #eee8d5; --note-color-grey-border: #93a1a1;
}

body.theme-solarized-dark {
     --bg-color: #002b36; /* base03 */
     --text-color: #839496; /* base0 */
     --card-bg-color: #073642; /* base02 */
     --border-color: #586e75; /* base01 */
     --primary-text-color: #fdf6e3; /* base3 */
     --secondary-color: #586e75; /* base01 */
     --danger-color: #dc322f; /* red */
     --success-color: #859900; /* green */
     --input-bg-color: #073642;
     --input-border-color: #586e75;
     --shadow-color: rgba(0, 0, 0, 0.25);
     --shadow-hover-color: rgba(0, 0, 0, 0.35);
     --tag-bg-color: #586e75;
     --tag-text-color: #eee8d5; /* base2 */
     --pin-color: var(--secondary-color);
     --pinned-color: #b58900; /* yellow */
     --highlight-bg-color: #586e75;
     --highlight-text-color: #fdf6e3;
     --archive-color: var(--secondary-color);
     --fade-color-start: rgba(7, 54, 66, 0);
     --fade-color-end: rgba(7, 54, 66, 1);
     --modal-backdrop-color: rgba(0, 0, 0, 0.7);
     --modal-content-bg: #073642;
     --modal-border-color: #586e75;

     /* Tab variables for Solarized Dark */
     --tab-bg: #00252e;
     --tab-text: var(--secondary-color);
     --tab-border-color: var(--border-color);
     --tab-hover-bg: #073642;
     --tab-hover-text: #93a1a1; /* base0 */
     --tab-active-bg: var(--card-bg-color);
     --tab-active-border: var(--primary-color);
     --tab-active-text: var(--primary-color);

     /* Dog-ear variables for Solarized Dark */
     --dog-ear-bg: var(--bg-color);
     --dog-ear-shadow: rgba(0, 0, 0, 0.3);

     /* Noise texture for Solarized Dark */
     --noise-opacity: 0.04;

     /* NEW: Move Note Menu Solarized Dark */
     --move-menu-bg: var(--modal-content-bg);
     --move-menu-border: var(--modal-border-color);
     --move-menu-shadow: var(--shadow-hover-color);
     --move-menu-item-hover-bg: var(--tab-hover-bg);

    --setting-section-bg: rgba(253, 246, 227, 0.05);
    --setting-option-hover-bg: rgba(253, 246, 227, 0.1);

    /* Note Color Variables (Solarized Dark) */
    --note-color-yellow-bg: #3a300a; --note-color-yellow-border: #b58900;
    --note-color-blue-bg: #0d3f54; --note-color-blue-border: #268bd2;
    --note-color-green-bg: #2a3d00; --note-color-green-border: #859900;
    --note-color-red-bg: #4d1c1a; --note-color-red-border: #dc322f;
    --note-color-purple-bg: #2d2f51; --note-color-purple-border: #6c71c4;
    --note-color-grey-bg: #073642; --note-color-grey-border: #586e75;
}

/* --- Nord Theme --- */
body.theme-nord {
    --bg-color: #2E3440; --text-color: #D8DEE9; --card-bg-color: #3B4252; --border-color: #4C566A; --primary-color: #88C0D0; --primary-text-color: #2E3440; --secondary-color: #E5E9F0; --danger-color: #BF616A; --success-color: #A3BE8C; --input-bg-color: #434C5E; --input-border-color: #4C566A; --shadow-color: rgba(0, 0, 0, 0.2); --shadow-hover-color: rgba(0, 0, 0, 0.3); --tag-bg-color: #4C566A; --tag-text-color: #ECEFF4; --pin-color: var(--secondary-color); --pinned-color: #EBCB8B; --highlight-bg-color: #4C566A; --highlight-text-color: #EBCB8B; --fade-color-start: rgba(59, 66, 82, 0); --fade-color-end: rgba(59, 66, 82, 1); --modal-backdrop-color: rgba(46, 52, 64, 0.7); --modal-content-bg: #3B4252; --modal-border-color: #4C566A;
    --tab-bg: #353c4a; --tab-text: #D8DEE9; --tab-border-color: var(--border-color); --tab-hover-bg: #434c5e; --tab-hover-text: #ECEFF4; --tab-active-bg: var(--card-bg-color); --tab-active-border: var(--primary-color); --tab-active-text: var(--primary-color); --dog-ear-bg: var(--bg-color); --dog-ear-shadow: rgba(0, 0, 0, 0.3); --noise-opacity: 0.03; --setting-section-bg: rgba(216, 222, 233, 0.04); --setting-option-hover-bg: rgba(216, 222, 233, 0.1);
    --move-menu-bg: var(--modal-content-bg); --move-menu-border: var(--modal-border-color); --move-menu-shadow: var(--shadow-hover-color); --move-menu-item-hover-bg: var(--tab-hover-bg);
    --note-color-yellow-bg: #4a453a; --note-color-yellow-border: #EBCB8B; --note-color-blue-bg: #3a485e; --note-color-blue-border: #81A1C1; --note-color-green-bg: #404c41; --note-color-green-border: #A3BE8C; --note-color-red-bg: #513a3f; --note-color-red-border: #BF616A; --note-color-purple-bg: #4a425e; --note-color-purple-border: #B48EAD; --note-color-grey-bg: #434C5E; --note-color-grey-border: #4C566A;
}

/* --- Gruvbox Dark Theme --- */
body.theme-gruvbox-dark {
    --bg-color: #282828; --text-color: #ebdbb2; --card-bg-color: #3c3836; --border-color: #504945; --primary-color: #fabd2f; --primary-text-color: #282828; --secondary-color: #a89984; --danger-color: #fb4934; --success-color: #b8bb26; --input-bg-color: #504945; --input-border-color: #665c54; --shadow-color: rgba(0, 0, 0, 0.25); --shadow-hover-color: rgba(0, 0, 0, 0.35); --tag-bg-color: #504945; --tag-text-color: #ebdbb2; --pin-color: var(--secondary-color); --pinned-color: #fabd2f; --highlight-bg-color: #504945; --highlight-text-color: #fabd2f; --fade-color-start: rgba(60, 56, 54, 0); --fade-color-end: rgba(60, 56, 54, 1); --modal-backdrop-color: rgba(40, 40, 40, 0.7); --modal-content-bg: #3c3836; --modal-border-color: #504945;
    --tab-bg: #32302f; --tab-text: #a89984; --tab-border-color: var(--border-color); --tab-hover-bg: #504945; --tab-hover-text: #ebdbb2; --tab-active-bg: var(--card-bg-color); --tab-active-border: var(--primary-color); --tab-active-text: var(--primary-color); --dog-ear-bg: var(--bg-color); --dog-ear-shadow: rgba(0, 0, 0, 0.3); --noise-opacity: 0.05; --setting-section-bg: rgba(235, 219, 178, 0.04); --setting-option-hover-bg: rgba(235, 219, 178, 0.1);
    --move-menu-bg: var(--modal-content-bg); --move-menu-border: var(--modal-border-color); --move-menu-shadow: var(--shadow-hover-color); --move-menu-item-hover-bg: var(--tab-hover-bg);
    --note-color-yellow-bg: #4a453a; --note-color-yellow-border: #fabd2f; --note-color-blue-bg: #374a5a; --note-color-blue-border: #83a598; --note-color-green-bg: #464a3a; --note-color-green-border: #b8bb26; --note-color-red-bg: #513a3f; --note-color-red-border: #fb4934; --note-color-purple-bg: #4a425e; --note-color-purple-border: #d3869b; --note-color-grey-bg: #504945; --note-color-grey-border: #665c54;
}

/* --- Gruvbox Light Theme --- */
body.theme-gruvbox-light {
    --bg-color: #fbf1c7; --text-color: #3c3836; --card-bg-color: #ebdbb2; --border-color: #d5c4a1; --primary-color: #d65d0e; --primary-text-color: #fbf1c7; --secondary-color: #7c6f64; --danger-color: #cc241d; --success-color: #98971a; --input-bg-color: #f9f5d7; --input-border-color: #d5c4a1; --shadow-color: rgba(60, 56, 54, 0.1); --shadow-hover-color: rgba(60, 56, 54, 0.15); --tag-bg-color: #d5c4a1; --tag-text-color: #3c3836; --pin-color: var(--secondary-color); --pinned-color: #d79921; --highlight-bg-color: #d5c4a1; --highlight-text-color: #af3a03; --fade-color-start: rgba(235, 219, 178, 0); --fade-color-end: rgba(235, 219, 178, 1); --modal-backdrop-color: rgba(251, 241, 199, 0.6); --modal-content-bg: #f9f5d7; --modal-border-color: #d5c4a1;
    --tab-bg: #f2e5bc; --tab-text: #7c6f64; --tab-border-color: var(--border-color); --tab-hover-bg: #d5c4a1; --tab-hover-text: #282828; --tab-active-bg: var(--card-bg-color); --tab-active-border: var(--primary-color); --tab-active-text: var(--primary-color); --dog-ear-bg: var(--bg-color); --dog-ear-shadow: rgba(60, 56, 54, 0.1); --noise-opacity: 0.04; --setting-section-bg: rgba(60, 56, 54, 0.03); --setting-option-hover-bg: rgba(60, 56, 54, 0.07);
    --move-menu-bg: var(--modal-content-bg); --move-menu-border: var(--modal-border-color); --move-menu-shadow: var(--shadow-hover-color); --move-menu-item-hover-bg: var(--tab-hover-bg);
    --note-color-yellow-bg: #f2e5bc; --note-color-yellow-border: #d79921; --note-color-blue-bg: #d3e8e5; --note-color-blue-border: #458588; --note-color-green-bg: #e4e5bf; --note-color-green-border: #98971a; --note-color-red-bg: #f4cfcd; --note-color-red-border: #cc241d; --note-color-purple-bg: #e9d1d9; --note-color-purple-border: #b16286; --note-color-grey-bg: #d5c4a1; --note-color-grey-border: #bdae93;
}

/* --- Dracula Theme --- */
body.theme-dracula {
    --bg-color: #282a36; --text-color: #f8f8f2; --card-bg-color: #44475a; --border-color: #6272a4; --primary-color: #bd93f9; --primary-text-color: #f8f8f2; --secondary-color: #f8f8f2; --danger-color: #ff5555; --success-color: #50fa7b; --input-bg-color: #282a36; --input-border-color: #6272a4; --shadow-color: rgba(0, 0, 0, 0.25); --shadow-hover-color: rgba(0, 0, 0, 0.35); --tag-bg-color: #6272a4; --tag-text-color: #f8f8f2; --pin-color: #6272a4; --pinned-color: #f1fa8c; --highlight-bg-color: #44475a; --highlight-text-color: #f1fa8c; --fade-color-start: rgba(68, 71, 90, 0); --fade-color-end: rgba(68, 71, 90, 1); --modal-backdrop-color: rgba(40, 42, 54, 0.7); --modal-content-bg: #44475a; --modal-border-color: #6272a4;
    --tab-bg: #3a3c4e; --tab-text: #bd93f9; --tab-border-color: var(--border-color); --tab-hover-bg: #6272a4; --tab-hover-text: #ff79c6; --tab-active-bg: var(--card-bg-color); --tab-active-border: var(--primary-color); --tab-active-text: var(--primary-color); --dog-ear-bg: var(--bg-color); --dog-ear-shadow: rgba(0, 0, 0, 0.3); --noise-opacity: 0.03; --setting-section-bg: rgba(248, 248, 242, 0.04); --setting-option-hover-bg: rgba(248, 248, 242, 0.1);
    --move-menu-bg: var(--modal-content-bg); --move-menu-border: var(--modal-border-color); --move-menu-shadow: var(--shadow-hover-color); --move-menu-item-hover-bg: var(--tab-hover-bg);
    --note-color-yellow-bg: #4a483a; --note-color-yellow-border: #f1fa8c; --note-color-blue-bg: #3a5068; --note-color-blue-border: #8be9fd; --note-color-green-bg: #304d3a; --note-color-green-border: #50fa7b; --note-color-red-bg: #5c3030; --note-color-red-border: #ff5555; --note-color-purple-bg: #4a425e; --note-color-purple-border: #bd93f9; --note-color-grey-bg: #6272a4; --note-color-grey-border: #44475a;
}

/* --- Monochrome Theme (Light) --- */
body.theme-monochrome {
    --bg-color: #f5f5f5; --text-color: #212121; --card-bg-color: #ffffff; --border-color: #e0e0e0; --primary-color: #616161; --primary-text-color: #ffffff; --secondary-color: #757575; --danger-color: #757575; --success-color: #616161; --input-bg-color: #ffffff; --input-border-color: #bdbdbd; --shadow-color: rgba(0, 0, 0, 0.08); --shadow-hover-color: rgba(0, 0, 0, 0.12); --tag-bg-color: #eeeeee; --tag-text-color: #616161; --pin-color: var(--secondary-color); --pinned-color: #424242; --highlight-bg-color: #e0e0e0; --highlight-text-color: #212121; --fade-color-start: rgba(255, 255, 255, 0); --fade-color-end: rgba(255, 255, 255, 1); --modal-backdrop-color: rgba(0, 0, 0, 0.6); --modal-content-bg: #ffffff; --modal-border-color: #e0e0e0;
    --tab-bg: #eeeeee; --tab-text: var(--secondary-color); --tab-border-color: var(--border-color); --tab-hover-bg: #e0e0e0; --tab-hover-text: var(--primary-color); --tab-active-bg: var(--card-bg-color); --tab-active-border: var(--primary-color); --tab-active-text: var(--primary-color); --dog-ear-bg: var(--bg-color); --dog-ear-shadow: rgba(0, 0, 0, 0.1); --noise-opacity: 0.02; --setting-section-bg: rgba(0, 0, 0, 0.02); --setting-option-hover-bg: rgba(0, 0, 0, 0.05);
    --move-menu-bg: var(--modal-content-bg); --move-menu-border: var(--modal-border-color); --move-menu-shadow: var(--shadow-hover-color); --move-menu-item-hover-bg: var(--tab-hover-bg);
    --note-color-yellow-bg: #fafafa; --note-color-yellow-border: #bdbdbd; --note-color-blue-bg: #f5f5f5; --note-color-blue-border: #9e9e9e; --note-color-green-bg: #eeeeee; --note-color-green-border: #757575; --note-color-red-bg: #f5f5f5; --note-color-red-border: #616161; --note-color-purple-bg: #fafafa; --note-color-purple-border: #9e9e9e; --note-color-grey-bg: #eeeeee; --note-color-grey-border: #bdbdbd;
}

/* ================================================= */


/* --- CSS Cơ bản --- */
body {
    font-family: var(--content-font-family, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif);
    margin: 0;
    padding: 20px; /* Padding mặc định cho desktop */
    background-color: var(--bg-color);
    color: var(--text-color);
    font-size: calc(1rem * var(--font-size-scale, 1));
    line-height: 1.6;
    transition: background-color 0.3s, color 0.3s, font-size 0.1s linear;
}

/* --- Header & Controls --- */
.app-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
    gap: 15px;
    margin-bottom: 10px;
    padding-bottom: 15px;
    border-bottom: 1px solid var(--border-color);
}
.app-header h1 {
    margin: 0;
    font-size: 1.8em;
    color: var(--primary-color);
    white-space: nowrap; /* Giữ tiêu đề trên 1 dòng (trên desktop) */
    overflow: hidden;
    text-overflow: ellipsis;
    flex-shrink: 0;
    margin-right: auto; /* Đẩy các nút actions sang phải */
}

.header-actions {
    display: flex;
    flex-wrap: wrap; /* Cho phép nút xuống hàng */
    gap: 8px;
    align-items: center;
    flex-shrink: 0;
}
.header-actions button { padding: 8px 12px; background-color: var(--secondary-color); color: var(--primary-text-color); border: none; border-radius: 5px; cursor: pointer; transition: background-color 0.2s, opacity 0.2s; font-size: 0.9em; white-space: nowrap; line-height: 1.4; }
.header-actions button:hover { opacity: 0.85; }
#export-notes-btn { background-color: var(--success-color); }
#import-notes-btn { background-color: var(--primary-color); }
#manage-notebooks-btn { background-color: #6f42c1; }
body.dark-mode #manage-notebooks-btn { background-color: #8a63d2; }
#manage-templates-btn { background-color: #17a2b8; }
body.dark-mode #manage-templates-btn { background-color: #34a4b7; }
#empty-trash-btn { background-color: var(--danger-color); }
#empty-trash-btn.hidden { display: none !important; }
#view-archive-btn { background-color: var(--secondary-color); }
#view-archive-btn.viewing-archive { background-color: var(--primary-color); font-weight: bold; }
#view-trash-btn { background-color: var(--secondary-color); }
#view-trash-btn.viewing-trash { background-color: var(--danger-color); font-weight: bold; }
#settings-btn { background-color: #ffc107; color: #333; }
#theme-toggle-btn { background-color: var(--secondary-color); min-width: 110px; text-align: center; }

.archive-status, .trash-status { width: 100%; text-align: center; padding: 8px; margin-top: 5px; margin-bottom: 15px; font-size: 0.9em; font-style: italic; color: var(--secondary-color); border-radius: 4px; background-color: var(--setting-section-bg); }

/* === Notebook Tabs Styles (UPDATED) === */
.notebook-tabs {
    display: flex;
    flex-wrap: nowrap; /* Mặc định không xuống dòng, cho phép cuộn ngang */
    gap: 4px; /* Tăng nhẹ khoảng cách */
    padding: 0;
    margin-bottom: 25px;
    border-bottom: 1px solid var(--tab-border-color);
    overflow-x: auto; /* Cho phép cuộn ngang */
    scrollbar-width: thin; /* Style thanh cuộn */
    scrollbar-color: var(--secondary-color) var(--bg-color);
    position: relative; /* Cho ::after */
}
/* Style thanh cuộn cho Webkit (Chrome, Safari) */
.notebook-tabs::-webkit-scrollbar { height: 6px; }
.notebook-tabs::-webkit-scrollbar-track { background: var(--bg-color); border-radius: 3px; }
.notebook-tabs::-webkit-scrollbar-thumb { background-color: var(--secondary-color); border-radius: 3px; }
.notebook-tabs::-webkit-scrollbar-thumb:hover { background-color: var(--primary-color); }

.tab-button {
    padding: 10px 18px;
    border: 1px solid var(--tab-border-color); /* Viền nhẹ cho tab thường */
    border-bottom: none;
    background-color: var(--tab-bg);
    color: var(--tab-text);
    cursor: pointer;
    font-size: 0.95em;
    font-weight: 500;
    white-space: nowrap; /* Giữ tên tab trên 1 dòng */
    transition: color 0.2s, border-color 0.2s, background-color 0.2s, box-shadow 0.2s;
    border-radius: var(--tab-radius);
    margin-bottom: -1px; /* Che đường border bottom của container */
    flex-shrink: 0; /* Ngăn tab bị co lại */
    position: relative;
    box-shadow: inset 0 -2px 5px -2px rgba(0,0,0,0.05); /* Bóng đổ nhẹ bên trong */
}

.tab-button:hover {
    color: var(--tab-hover-text);
    background-color: var(--tab-hover-bg);
    border-color: var(--border-color); /* Đổi màu viền khi hover */
    z-index: 1; /* Nổi lên khi hover */
}

.tab-button.active {
    color: var(--tab-active-text);
    background-color: var(--tab-active-bg);
    border-color: var(--tab-border-color);
    border-bottom-color: var(--tab-active-bg); /* Làm nền tab che đường border bottom */
    font-weight: 600; /* Chữ đậm hơn */
    z-index: 2; /* Nổi lên cao nhất */
    box-shadow: 0 -2px 4px rgba(0,0,0,0.05); /* Bóng đổ nhẹ bên ngoài khi active */
}
/* Thêm đường gạch chân màu nhấn cho tab active */
.tab-button.active::after {
    content: '';
    position: absolute;
    bottom: 0px; /* Nằm ngay trên đường border bottom bị che */
    left: 0;
    right: 0;
    height: 3px;
    background-color: var(--tab-active-border);
    border-radius: 2px 2px 0 0;
}


.add-tab-button {
    padding: 8px 12px;
    margin-left: 8px; /* Khoảng cách với tab cuối */
    margin-bottom: 2px; /* Căn chỉnh với các tab khác */
    border: 1px dashed var(--secondary-color); /* Đổi thành dashed */
    border-radius: 50%; /* Làm nút tròn */
    background-color: transparent;
    color: var(--secondary-color);
    font-size: 1.1em;
    font-weight: bold;
    cursor: pointer;
    transition: color 0.2s, border-color 0.2s, background-color 0.2s, transform 0.1s;
    line-height: 1; /* Đảm bảo dấu "+" căn giữa */
    flex-shrink: 0;
    align-self: center; /* Căn giữa theo chiều dọc với các tab */
}

.add-tab-button:hover {
    color: var(--primary-color);
    border-color: var(--primary-color);
    border-style: solid; /* Chuyển thành solid khi hover */
    background-color: var(--tab-hover-bg);
    transform: scale(1.1);
}


.controls-container { margin-bottom: 30px; position: relative; }
#search-input { display: block; width: calc(100% - 22px); /* Trừ padding 2 bên */ padding: 10px; margin-bottom: 20px; border: 1px solid var(--input-border-color); border-radius: 5px; background-color: var(--input-bg-color); color: var(--text-color); font-size: 1em; }
#search-input:focus { outline: none; border-color: var(--primary-color); box-shadow: 0 0 0 2px rgba(var(--rgb-primary-color, 0, 123, 255), 0.25); /* Cần định nghĩa --rgb-primary-color nếu muốn dùng */ }


/* --- Panel Thêm Note --- */
#add-note-panel { padding: 20px; margin-bottom: 20px; background-color: var(--card-bg-color); border: 1px solid var(--border-color); border-radius: 8px; box-shadow: 0 3px 8px var(--shadow-color); position: relative; }
.hidden { display: none !important; }
#add-note-panel .form-group { margin-bottom: 15px; }
#add-note-panel label { display: block; margin-bottom: 5px; font-weight: 500; font-size: 0.9em; color: var(--secondary-color); }
#add-note-panel select, #add-note-panel textarea, #add-note-panel input[type="text"] { display: block; width: calc(100% - 22px); /* Trừ padding 2 bên */ padding: 10px; border: 1px solid var(--input-border-color); border-radius: 5px; background-color: var(--input-bg-color); color: var(--text-color); font-size: 1em; font-family: inherit; }
#add-note-panel select { width: 100%; cursor: pointer; }
#add-note-panel textarea { min-height: 80px; resize: vertical; line-height: 1.5; }
#add-note-panel input:focus, #add-note-panel textarea:focus, #add-note-panel select:focus { outline: none; border-color: var(--primary-color); box-shadow: 0 0 0 2px rgba(var(--rgb-primary-color, 0, 123, 255), 0.25); }
#add-note-panel .panel-actions { display: flex; justify-content: flex-end; align-items: center; margin-top: 15px; gap: 10px; }
#add-note-panel #add-note-btn { padding: 10px 20px; background-color: var(--primary-color); color: var(--primary-text-color); border: none; border-radius: 5px; cursor: pointer; font-size: 1em; transition: background-color 0.2s, opacity 0.2s; }
#add-note-panel #add-note-btn:hover { opacity: 0.85; }
#add-note-panel #close-add-panel-btn { padding: 8px 15px; background-color: var(--secondary-color); color: var(--primary-text-color); border: none; border-radius: 5px; cursor: pointer; font-size: 0.9em; transition: background-color 0.2s, opacity 0.2s; }
#add-note-panel #close-add-panel-btn:hover { opacity: 0.85; }


/* --- Notes Container & Note Card (IMPROVED + DOG-EAR + NOISE) --- */
#notes-container {
    display: grid;
    /* Tự động điều chỉnh số cột, mỗi cột tối thiểu 250px, tối đa 1 phần bằng nhau */
    grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
    gap: var(--note-gap, 20px); /* Khoảng cách giữa các note */
}
.note {
    border: 1px solid var(--border-color);
    border-radius: 8px;
    padding: 15px 18px;
    box-shadow: 0 1px 3px var(--shadow-color);
    display: flex;
    flex-direction: column;
    transition: box-shadow 0.25s ease-in-out, transform 0.25s ease-in-out, background-color 0.3s, border-color 0.3s, border-left-color 0.3s;
    cursor: grab; /* Con trỏ kéo thả */
    user-select: none; /* Ngăn chọn text khi kéo */
    -webkit-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;
    position: relative;
    overflow: hidden; /* Quan trọng cho dog-ear và noise */
    min-height: 150px; /* Chiều cao tối thiểu */
    border-left: 5px solid transparent; /* Viền màu bên trái */
    background-color: var(--card-bg-color);
}

/* Noise texture overlay */
.note::after {
    content: "";
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-image: var(--noise-url);
    opacity: var(--noise-opacity);
    pointer-events: none; /* Cho phép click xuyên qua */
    z-index: 0; /* Nằm dưới nội dung */
    transition: opacity 0.3s;
}


.note:active { cursor: grabbing; } /* Con trỏ khi đang kéo */
.note:hover {
    box-shadow: 0 5px 15px var(--shadow-hover-color);
    transform: translateY(-3px); /* Hiệu ứng nhấc lên */
}

/* Dog-ear effect */
.note::before {
    content: "";
    position: absolute;
    top: 0;
    right: 0;
    border-width: 0 var(--dog-ear-size) var(--dog-ear-size) 0;
    border-style: solid;
    border-color: transparent transparent var(--dog-ear-bg) var(--dog-ear-bg);
    box-shadow: -1px 1px 2px var(--dog-ear-shadow);
    z-index: 1; /* Nằm trên noise, dưới nội dung */
    transition: border-color 0.3s;
}
/* Adjust dog-ear color for colored notes */
.note.note-color-yellow::before { border-color: transparent transparent var(--note-color-yellow-bg) var(--note-color-yellow-bg); }
.note.note-color-blue::before { border-color: transparent transparent var(--note-color-blue-bg) var(--note-color-blue-bg); }
.note.note-color-green::before { border-color: transparent transparent var(--note-color-green-bg) var(--note-color-green-bg); }
.note.note-color-red::before { border-color: transparent transparent var(--note-color-red-bg) var(--note-color-red-bg); }
.note.note-color-purple::before { border-color: transparent transparent var(--note-color-purple-bg) var(--note-color-purple-bg); }
.note.note-color-grey::before { border-color: transparent transparent var(--note-color-grey-bg) var(--note-color-grey-bg); }


.pinned-bookmark-icon { position: absolute; top: -10px; right: -10px; font-size: 2.8em; color: var(--pinned-color); opacity: 0.5; pointer-events: none; transform: rotate(45deg); z-index: 2; transition: color 0.3s, opacity 0.3s; }
/* Note color classes - Update background-color only */
.note.note-color-yellow { background-color: var(--note-color-yellow-bg); border-left-color: var(--note-color-yellow-border); }
.note.note-color-blue { background-color: var(--note-color-blue-bg); border-left-color: var(--note-color-blue-border); }
.note.note-color-green { background-color: var(--note-color-green-bg); border-left-color: var(--note-color-green-border); }
.note.note-color-red { background-color: var(--note-color-red-bg); border-left-color: var(--note-color-red-border); }
.note.note-color-purple { background-color: var(--note-color-purple-bg); border-left-color: var(--note-color-purple-border); }
.note.note-color-grey { background-color: var(--note-color-grey-bg); border-left-color: var(--note-color-grey-border); }
/* Reset các border khác khi có màu */
.note[class*="note-color-"] { border-top-color: transparent; border-right-color: transparent; border-bottom-color: transparent; }

.note-title {
    font-size: 1.15em;
    font-weight: 600;
    margin: 0 0 10px 0;
    word-wrap: break-word; /* Tự xuống dòng nếu tiêu đề dài */
    color: var(--primary-color);
    position: relative; /* Để z-index hoạt động */
    z-index: 1; /* Nằm trên noise và dog-ear */
    padding-bottom: 8px;
    border-bottom: 1px solid var(--border-color);
    margin-bottom: 12px;
}
.note-content {
    flex-grow: 1; /* Cho phép nội dung chiếm không gian còn lại */
    word-wrap: break-word; /* Tự xuống dòng */
    white-space: pre-wrap; /* Giữ lại khoảng trắng và xuống dòng từ textarea */
    font-size: 1em;
    position: relative;
    z-index: 1;
    max-height: 200px; /* Giới hạn chiều cao ban đầu */
    overflow: hidden; /* Ẩn phần nội dung thừa */
    font-family: var(--content-font-family, inherit);
    line-height: 1.5;
    color: var(--text-color);
}
/* Lớp phủ mờ dần cho nội dung bị tràn */
.note-content.has-overflow { position: relative; }
.note-content.has-overflow::after {
    content: "";
    position: absolute;
    bottom: 0;
    left: 0;
    width: 100%;
    height: 40px;
    background: linear-gradient(to top, var(--fade-color-end), var(--fade-color-start));
    pointer-events: none;
    z-index: 2; /* Nằm trên cả nội dung */
}
/* Nút "Xem thêm" */
.read-more-btn {
    display: block;
    margin: 5px auto 0 auto;
    padding: 3px 10px;
    font-size: 0.8em;
    color: var(--primary-color);
    background-color: transparent;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    text-align: center;
    z-index: 3; /* Nằm trên lớp phủ mờ */
    position: relative;
    text-decoration: underline;
    opacity: 0.8;
}
.read-more-btn:hover { opacity: 1; }

.note-timestamp { font-size: 0.8em; color: var(--secondary-color); margin-bottom: 10px; display: block; position: relative; z-index: 1; opacity: 0.8; }
.note-tags { margin-bottom: 10px; display: flex; flex-wrap: wrap; gap: 5px; position: relative; z-index: 1; }
.tag-badge { background-color: var(--tag-bg-color); color: var(--tag-text-color); padding: 3px 8px; border-radius: 10px; font-size: 0.8em; transition: background-color 0.2s, color 0.2s, opacity 0.2s; border: none; cursor: pointer; line-height: 1.4; opacity: 0.9; }
.tag-badge:hover { opacity: 1; background-color: var(--primary-color); color: var(--primary-text-color); }
.note-actions { display: flex; justify-content: flex-end; align-items: center; gap: 5px; border-top: 1px solid var(--border-color); padding-top: 10px; margin-top: auto; /* Đẩy xuống dưới cùng */ position: relative; z-index: 1; }
.note-actions button { padding: 5px; border: none; border-radius: 50%; width: 30px; height: 30px; display: inline-flex; align-items: center; justify-content: center; cursor: pointer; font-size: 1.1em; transition: opacity 0.2s, color 0.2s, background-color 0.2s; background-color: transparent; color: var(--secondary-color); line-height: 1; }
.note-actions button:hover {
    opacity: 1;
    background-color: rgba(128, 128, 128, 0.15); /* Nền nhẹ khi hover */
}
.note-actions .edit-btn { color: var(--primary-color); }
.note-actions .delete-btn, .note-actions .delete-permanent-btn { color: var(--danger-color); }
.note-actions .pin-btn { color: var(--pin-color); }
.note-actions .pin-btn.pinned { color: var(--pinned-color); }
.note-actions .unarchive-btn, .note-actions .restore-btn { color: var(--success-color); }
.note-actions .delete-permanent-btn { font-weight: bold; font-size: 0.8em; }
.note-actions .edit-btn { font-size: 0.9em; }
.note-actions .delete-btn { font-size: 0.9em; }


/* --- Note Edit Mode --- */
.note input[type="text"].edit-title-input,
.note textarea.edit-input,
.note input[type="text"].edit-tags-input {
    display: block;
    width: calc(100% - 12px); /* Trừ padding 2 bên */
    margin-bottom: 10px;
    border: 1px solid var(--input-border-color);
    border-radius: 5px;
    background-color: var(--input-bg-color);
    color: var(--text-color);
    font-size: 1em;
    padding: 5px;
    cursor: text;
    position: relative;
    z-index: 2; /* Nằm trên các hiệu ứng nền */
    font-family: inherit;
}
.note input[type="text"].edit-title-input {
    font-weight: 600;
    border-bottom: 1px solid var(--input-border-color);
    padding-bottom: 5px;
    margin-bottom: 10px;
}
.note textarea.edit-input {
    min-height: 80px;
    resize: vertical;
    line-height: 1.5;
    white-space: pre-wrap;
    margin-top: 0;
}

.note input:focus, .note textarea:focus { outline: none; border-color: var(--primary-color); box-shadow: 0 0 0 2px rgba(var(--rgb-primary-color, 0, 123, 255), 0.25); }


/* --- Color Selector Styles --- */
.color-selector-container { display: flex; flex-wrap: wrap; gap: 8px; margin-top: 8px; margin-bottom: 12px; padding: 5px 0; position: relative; z-index: 2; }
.color-swatch-btn { width: 24px; height: 24px; border-radius: 50%; border: 2px solid transparent; cursor: pointer; padding: 0; font-size: 0; /* Ẩn text nếu có */ transition: transform 0.1s ease-out, border-color 0.2s, box-shadow 0.2s; box-shadow: 0 1px 2px rgba(0,0,0,0.2); display: flex; align-items: center; justify-content: center; }
.color-swatch-btn:hover { transform: scale(1.1); }
.color-swatch-btn.selected { border-color: var(--primary-color); transform: scale(1.15); box-shadow: 0 0 0 2px var(--bg-color), 0 0 0 4px var(--primary-color); /* Hiệu ứng viền kép */ }
.color-swatch-btn.default-color-swatch { background-color: var(--card-bg-color); border: 1px dashed var(--secondary-color); color: var(--secondary-color); font-size: 14px; line-height: 20px; text-align: center; box-shadow: none; }
.color-swatch-btn.default-color-swatch:hover { border-style: solid; border-color: var(--secondary-color); }
.color-swatch-btn.default-color-swatch.selected { border: 2px solid var(--primary-color) !important; box-shadow: 0 0 0 2px var(--bg-color), 0 0 0 4px var(--primary-color); background-color: var(--card-bg-color); color: var(--primary-color); }

/* --- Other Styles --- */
.empty-state { grid-column: 1 / -1; /* Chiếm toàn bộ grid */ text-align: center; color: var(--secondary-color); padding: 30px; font-style: italic; }
#template-list-container .empty-state,
#notebook-list-container .empty-state { padding: 15px; grid-column: auto; /* Reset grid-column trong modal */ }

/* --- SortableJS Styles --- */
.note.sortable-ghost { opacity: 0.4; background-color: var(--primary-color) !important; border: 1px dashed var(--primary-text-color); transform: translateY(0); }
.note.sortable-chosen { opacity: 0.9; box-shadow: 0 5px 15px var(--shadow-color); transform: scale(1.02) translateY(-3px); cursor: grabbing; }
.note.sortable-drag { opacity: 0.9; cursor: grabbing; transform: scale(1.02) translateY(-3px); }

/* --- Floating Action Button (FAB) --- */
.fab { position: fixed; bottom: 30px; right: 30px; width: 55px; height: 55px; background-color: var(--fab-bg-color); color: var(--fab-text-color); border: none; border-radius: 50%; font-size: 28px; line-height: 55px; text-align: center; box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2); cursor: pointer; z-index: 1000; transition: transform 0.2s ease-in-out, background-color 0.3s, visibility 0s linear 0.1s, opacity 0.1s linear; }
.fab:hover { transform: scale(1.1); }
.fab.hidden { visibility: hidden; opacity: 0; transform: scale(0.5); transition-delay: 0s; }

/* --- Tag Suggestions --- */
.tag-suggestions { position: absolute; background-color: var(--card-bg-color); border: 1px solid var(--border-color); border-radius: 4px; box-shadow: 0 4px 8px var(--shadow-color); max-height: 150px; overflow-y: auto; z-index: 1001; width: auto; min-width: 150px; margin-top: 2px; }
.suggestion-item { padding: 8px 12px; cursor: pointer; font-size: 0.9em; color: var(--text-color); border-bottom: 1px solid var(--border-color); white-space: nowrap; outline: none; }
.suggestion-item:last-child { border-bottom: none; }
.suggestion-item:hover, .suggestion-item:focus { background-color: var(--setting-option-hover-bg); color: var(--primary-color); }

/* --- Highlighted Text (Search) --- */
mark { background-color: var(--highlight-bg-color); color: var(--highlight-text-color); padding: 0.1em 0.2em; border-radius: 3px; box-shadow: 0 0 0 1px var(--highlight-bg-color); }

/* --- Modal Styles (Generic) --- */
.modal { position: fixed; z-index: 2000; left: 0; top: 0; width: 100%; height: 100%; overflow: hidden; /* Ban đầu ẩn scroll */ background-color: var(--modal-backdrop-color); display: flex; align-items: center; justify-content: center; opacity: 0; visibility: hidden; transition: opacity 0.3s ease, visibility 0s linear 0.3s; }
.modal.visible { opacity: 1; visibility: visible; transition: opacity 0.3s ease, visibility 0s linear 0s; overflow-y: auto; /* Cho phép scroll khi hiện */ }
.modal:not(.hidden) { display: flex; } /* Đảm bảo modal hiển thị khi cần */
.modal-content { background-color: var(--modal-content-bg); color: var(--text-color); margin: 5vh auto; /* Căn giữa và cách top/bottom 5% viewport height */ padding: 20px 25px; border: 1px solid var(--modal-border-color); border-radius: 8px; width: 90%; /* Mặc định cho mobile */ max-height: 90vh; /* Giới hạn chiều cao */ overflow-y: auto; /* Cho phép nội dung modal scroll */ box-shadow: 0 5px 15px rgba(0,0,0,0.2); position: relative; display: flex; flex-direction: column; transition: transform 0.3s ease; transform: scale(0.95); /* Hiệu ứng zoom nhẹ */ }
.modal.visible .modal-content { transform: scale(1); }
/* Đặt max-width cụ thể cho từng loại modal (trên desktop) */
.note-modal .modal-content { max-width: 700px; }
.template-modal-content { max-width: 600px; }
.notebook-modal-content { max-width: 550px; }
.settings-modal-content { max-width: 650px; }

.modal-header { display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid var(--border-color); padding-bottom: 10px; margin-bottom: 20px; flex-shrink: 0; /* Ngăn header co lại */ }
.modal-header h2 { margin: 0; font-size: 1.4em; color: var(--primary-color); }
.modal-body { line-height: 1.6; flex-grow: 1; /* Cho phép body chiếm không gian */ padding-top: 5px; }
.note-modal .modal-body { white-space: pre-wrap; /* Giữ định dạng text trong modal xem note */ }
.close-modal-btn { background: none; border: none; color: var(--secondary-color); font-size: 28px; font-weight: bold; cursor: pointer; padding: 0 5px; line-height: 1; }
.close-modal-btn:hover, .close-modal-btn:focus { color: var(--text-color); opacity: 0.8; outline: none; }

/* --- Auto-save / Manual Save Visual Feedback --- */
@keyframes flash-border { 0% { box-shadow: 0 0 0 0 rgba(var(--rgb-success-color, 25, 135, 84), 0.5); } 70% { box-shadow: 0 0 0 5px rgba(var(--rgb-success-color, 25, 135, 84), 0); } 100% { box-shadow: 0 0 0 0 rgba(var(--rgb-success-color, 25, 135, 84), 0); } }
.note.note-autosaved, .note.note-saved-flash {
    /* animation: flash-border 0.6s ease-out; */ /* Tùy chọn: dùng animation thay vì chỉ đổi shadow */
    box-shadow: 0 0 0 2px var(--success-color);
    transition: box-shadow 0.2s ease-out;
}
body.dark-mode .note.note-autosaved, body.dark-mode .note.note-saved-flash {
    box-shadow: 0 0 0 2px var(--success-color);
}


/* --- Template Management Modal --- */
#template-list-section { margin-bottom: 20px; }
#template-list-section h3, #template-edit-panel h3 { margin-top: 0; margin-bottom: 15px; font-size: 1.2em; color: var(--primary-color); }
#template-list-container { margin-top: 15px; margin-bottom: 15px; max-height: 250px; overflow-y: auto; border: 1px solid var(--border-color); border-radius: 5px; padding: 5px; }
.template-list-item { display: flex; justify-content: space-between; align-items: center; padding: 8px 10px; border-bottom: 1px solid var(--border-color); }
.template-list-item:last-child { border-bottom: none; }
.template-list-item span { font-weight: 500; margin-right: 10px; word-break: break-word; }
.template-item-actions { display: flex; gap: 8px; flex-shrink: 0; }
#template-edit-panel { padding: 15px; border: 1px solid var(--border-color); border-radius: 5px; background-color: var(--setting-section-bg); }
#template-edit-panel .form-group { margin-bottom: 12px; }
#template-edit-panel label { display: block; margin-bottom: 4px; font-weight: 500; font-size: 0.9em; color: var(--secondary-color); }
#template-edit-panel input[type="text"], #template-edit-panel textarea { width: calc(100% - 22px); /* Trừ padding */ padding: 8px 10px; border: 1px solid var(--input-border-color); border-radius: 4px; background-color: var(--input-bg-color); color: var(--text-color); font-size: 1em; font-family: inherit; }
#template-edit-panel input:focus, #template-edit-panel textarea:focus { outline: none; border-color: var(--primary-color); box-shadow: 0 0 0 2px rgba(var(--rgb-primary-color, 0, 123, 255), 0.25); }
#template-edit-panel textarea { min-height: 70px; resize: vertical; line-height: 1.5; }
#template-edit-panel .panel-actions { display: flex; justify-content: flex-end; gap: 10px; margin-top: 15px; }

/* === Notebook Modal Styles === */
#notebook-list-section { margin-bottom: 20px; }
#notebook-list-section h3, #notebook-edit-panel h3 { margin-top: 0; margin-bottom: 15px; font-size: 1.2em; color: var(--primary-color); }
#notebook-list-container { margin-top: 15px; margin-bottom: 15px; max-height: 250px; overflow-y: auto; border: 1px solid var(--border-color); border-radius: 5px; padding: 5px; }
.notebook-list-item { display: flex; justify-content: space-between; align-items: center; padding: 8px 10px; border-bottom: 1px solid var(--border-color); }
.notebook-list-item:last-child { border-bottom: none; }
.notebook-list-item span { font-weight: 500; margin-right: 10px; word-break: break-word; }
.notebook-item-actions { display: flex; gap: 8px; flex-shrink: 0; }

#notebook-edit-panel { padding: 15px; border: 1px solid var(--border-color); border-radius: 5px; background-color: var(--setting-section-bg); }
#notebook-edit-panel .form-group { margin-bottom: 12px; }
#notebook-edit-panel label { display: block; margin-bottom: 4px; font-weight: 500; font-size: 0.9em; color: var(--secondary-color); }
#notebook-edit-panel input[type="text"] { width: calc(100% - 22px); padding: 8px 10px; border: 1px solid var(--input-border-color); border-radius: 4px; background-color: var(--input-bg-color); color: var(--text-color); font-size: 1em; font-family: inherit; }
#notebook-edit-panel input:focus { outline: none; border-color: var(--primary-color); box-shadow: 0 0 0 2px rgba(var(--rgb-primary-color, 0, 123, 255), 0.25); }
#notebook-edit-panel .panel-actions { display: flex; justify-content: flex-end; gap: 10px; margin-top: 15px; }

/* === Move Note Menu Styles === */
.move-note-menu {
    position: absolute;
    background-color: var(--move-menu-bg);
    border: 1px solid var(--move-menu-border);
    border-radius: 4px;
    box-shadow: 0 2px 8px var(--move-menu-shadow);
    min-width: 150px;
    max-height: 200px;
    overflow-y: auto;
    z-index: 10; /* Nằm trên note */
    padding: 5px 0;
}
.move-note-menu button {
    display: block;
    width: 100%;
    padding: 8px 15px;
    background: none;
    border: none;
    color: var(--text-color);
    text-align: left;
    cursor: pointer;
    font-size: 0.9em;
    white-space: nowrap;
}
.move-note-menu button:hover {
    background-color: var(--move-menu-item-hover-bg);
    color: var(--primary-color);
}
.move-note-menu button.current-notebook {
    font-weight: bold;
    color: var(--primary-color);
    cursor: default;
    background-color: transparent !important; /* Ghi đè hover */
}
.move-note-menu hr {
    border: none;
    border-top: 1px solid var(--move-menu-border);
    margin: 5px 0;
}


/* Generic Modal Button Styles */
.modal-button { padding: 8px 15px; border-radius: 5px; cursor: pointer; font-size: 0.95em; transition: background-color 0.2s, opacity 0.2s, border-color 0.2s, color 0.2s; border: 1px solid transparent; background-color: transparent; line-height: 1.4; }
.modal-button.primary { background-color: var(--primary-color); color: var(--primary-text-color); border-color: var(--primary-color); }
.modal-button.primary:hover { opacity: 0.85; }
.modal-button.secondary { background-color: var(--secondary-color); color: var(--primary-text-color); border-color: var(--secondary-color); }
.modal-button.secondary:hover { opacity: 0.85; }
.modal-button.danger { background-color: transparent; color: var(--danger-color); border-color: var(--danger-color); }
.modal-button.danger:hover { background-color: var(--danger-color); color: var(--primary-text-color); opacity: 0.9; }
.modal-button.small-button { padding: 5px 10px !important; font-size: 0.85em !important; }
#show-add-template-panel-btn,
#show-add-notebook-panel-btn { background-color: var(--success-color); color: var(--primary-text-color); border: none; margin-top: 10px; }
#show-add-template-panel-btn:hover,
#show-add-notebook-panel-btn:hover { opacity: 0.9; }

/* === CSS CHO MODAL CÀI ĐẶT === */
.setting-section { margin-bottom: 25px; padding-bottom: 15px; border-bottom: 1px solid var(--border-color); }
.setting-section:last-child { margin-bottom: 0; padding-bottom: 0; border-bottom: none; }
.setting-section h3 { margin-top: 0; margin-bottom: 15px; font-size: 1.2em; color: var(--primary-color); }
.setting-options-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(110px, 1fr)); gap: 10px; }
.setting-option-button { padding: 10px 15px; border: 1px solid var(--setting-option-border); border-radius: 5px; background-color: var(--card-bg-color); color: var(--text-color); cursor: pointer; text-align: center; font-size: 0.95em; transition: background-color 0.2s, border-color 0.2s, color 0.2s; }
.setting-option-button:hover { background-color: var(--setting-option-hover-bg); }
.setting-option-button.active { background-color: var(--setting-option-active-bg); color: var(--setting-option-active-text); border-color: var(--setting-option-active-border); font-weight: bold; }
.accent-color-options { display: flex; flex-wrap: wrap; gap: 10px; }
#font-family-select { width: 100%; padding: 8px 10px; border: 1px solid var(--input-border-color); border-radius: 5px; background-color: var(--input-bg-color); color: var(--text-color); font-size: 0.95em; cursor: pointer; }
body.dark-mode #font-family-select option { background-color: var(--card-bg-color); color: var(--text-color); }
.font-size-control { display: flex; align-items: center; gap: 15px; }
#font-size-slider { flex-grow: 1; cursor: pointer; accent-color: var(--primary-color); /* Màu của thanh slider */ }
#font-size-value { min-width: 45px; text-align: right; font-weight: 500; color: var(--secondary-color); }
#reset-font-size-btn {} /* Không cần style đặc biệt nếu dùng class modal-button */

/* Tiện ích ẩn accessibly */
.sr-only { position: absolute; width: 1px; height: 1px; padding: 0; margin: -1px; overflow: hidden; clip: rect(0, 0, 0, 0); white-space: nowrap; border-width: 0; }


/* ===================================================================== */
/* ==================== MOBILE RESPONSIVE STYLES ======================= */
/* ===================================================================== */

@media (max-width: 768px) { /* Breakpoint cho tablet nhỏ và điện thoại lớn */
    body {
        padding: 10px; /* Giảm padding trên màn hình nhỏ */
        font-size: calc(0.95rem * var(--font-size-scale, 1)); /* Có thể giảm nhẹ cỡ chữ cơ bản */
    }

    :root {
         --note-gap: 12px; /* Giảm khoảng cách giữa các note */
    }

    /* Grid cho notes thường tự xử lý tốt, nhưng có thể giảm minmax nếu cần */
    /* #notes-container {
        grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
    } */

    /* --- Header cho Mobile --- */
    .app-header {
        flex-direction: column; /* Chuyển sang bố cục cột */
        align-items: center; /* Căn giữa các thành phần */
        padding-bottom: 10px;
    }

    .app-header h1 {
        margin: 0 0 10px 0; /* Bỏ margin-right, thêm margin-bottom */
        white-space: normal; /* Cho phép tiêu đề xuống dòng */
        text-align: center; /* Căn giữa tiêu đề */
        font-size: 1.6em;
    }

    .header-actions {
        width: 100%; /* Cho phép các nút chiếm toàn bộ chiều rộng */
        justify-content: center; /* Căn giữa các nút */
        gap: 8px; /* Giảm khoảng cách nút */
    }

    .header-actions button {
        padding: 6px 10px; /* Làm nút nhỏ hơn */
        font-size: 0.85em;
    }

    /* Chỉ báo trạng thái */
    .archive-status, .trash-status {
        margin-top: 10px;
        margin-bottom: 10px;
    }

    /* === Notebook Tabs cho Mobile (UPDATED) === */
    .notebook-tabs {
        flex-wrap: wrap; /* Cho phép tab xuống dòng */
        /* overflow-x: visible; /* Không cần cuộn ngang nữa */
        /* border-bottom: none; /* Bỏ border dưới của container */
        margin-bottom: 15px; /* Giảm khoảng cách dưới */
        padding-bottom: 5px; /* Thêm padding dưới để không sát quá */
    }
    .tab-button {
        margin-bottom: 4px; /* Khoảng cách giữa các dòng tab */
        border: 1px solid var(--tab-border-color); /* Luôn có border */
        border-radius: 4px; /* Bo tròn đều */
        box-shadow: none; /* Bỏ shadow mặc định */
    }
    .tab-button.active {
        border-bottom-color: var(--tab-border-color); /* Hiện lại border dưới */
        box-shadow: inset 0 0 0 2px var(--tab-active-border); /* Viền trong thay vì đường gạch */
    }
    .tab-button.active::after {
        display: none; /* Bỏ đường gạch chân */
    }
    .add-tab-button {
        margin-left: 4px; /* Giảm margin */
        margin-bottom: 4px; /* Căn với các tab khác */
    }


    /* --- Nút FAB cho Mobile --- */
    .fab {
         bottom: 15px;
         right: 15px;
         width: 50px;
         height: 50px;
         font-size: 24px;
         line-height: 50px;
    }

    /* --- Tăng kích thước vùng chạm cho các nút action trong note --- */
    .note-actions button {
         width: 34px; /* Lớn hơn một chút */
         height: 34px;
         font-size: 1.2em; /* Có thể tăng nhẹ icon size */
    }
    .note-actions .edit-btn, .note-actions .delete-btn {
        font-size: 0.85em; /* Giữ text button nhỏ */
    }
     .note-actions .delete-permanent-btn {
        font-size: 0.75em;
    }


    /* --- Điều chỉnh Modal cho Mobile (UPDATED) --- */
    .modal-content {
         padding: 15px 20px; /* Giảm padding trong modal */
         width: 90%; /* Giữ nguyên hoặc giảm nhẹ nếu cần */
         max-width: 90%; /* Thêm max-width để đảm bảo không quá rộng */
         max-height: 85vh; /* Giảm chiều cao tối đa */
         margin: 7.5vh auto; /* Tăng margin dọc để đẩy ra xa cạnh màn hình */
    }
    .modal-header h2 {
         font-size: 1.2em; /* Giảm cỡ chữ tiêu đề modal */
    }
    .close-modal-btn {
        font-size: 26px; /* Giảm nhẹ nút đóng */
    }

    /* --- Panel Thêm Note --- */
    #add-note-panel {
        padding: 15px;
    }
    #add-note-panel textarea {
        min-height: 60px; /* Giảm chiều cao tối thiểu textarea */
    }
    #add-note-panel .panel-actions {
        gap: 8px;
    }
     #add-note-panel #add-note-btn {
        padding: 8px 15px;
        font-size: 0.95em;
     }
     #add-note-panel #close-add-panel-btn {
        padding: 6px 12px;
        font-size: 0.85em;
     }

     /* --- Tag Suggestions --- */
     .tag-suggestions {
        max-height: 120px; /* Giảm chiều cao tối đa box gợi ý */
     }
     .suggestion-item {
        padding: 6px 10px;
        font-size: 0.85em;
     }
}

@media (max-width: 600px) { /* Breakpoint nhỏ hơn cho nội dung modal và form */

    /* --- Tối ưu Form trong Modal --- */
    #template-edit-panel .form-group,
    #notebook-edit-panel .form-group,
    .settings-modal-content .form-group {
        /* Đảm bảo label và input/select/textarea hiển thị tốt */
        /* Mặc định có thể đã ổn với display: block, nhưng có thể cần: */
        /* display: flex; */
        /* flex-direction: column; */
        /* align-items: flex-start; */
    }
    #template-edit-panel .panel-actions,
    #notebook-edit-panel .panel-actions,
    .settings-modal-content .panel-actions { /* Nếu có class này */
        flex-wrap: wrap; /* Đảm bảo nút trong modal tự xuống hàng */
        justify-content: center; /* Căn giữa các nút */
        gap: 8px;
    }

    /* --- Tối ưu lưới trong Cài đặt --- */
    .settings-modal-content .setting-options-grid {
         grid-template-columns: repeat(auto-fit, minmax(100px, 1fr)); /* Giảm min cho nút theme/accent */
         gap: 8px;
    }
     .settings-modal-content .setting-option-button {
         padding: 8px 10px;
         font-size: 0.9em;
     }

    /* --- Nút Modal chung --- */
    .modal-button {
        padding: 7px 12px;
        font-size: 0.9em;
    }
     .modal-button.small-button {
        padding: 4px 8px !important;
        font-size: 0.8em !important;
    }

    /* --- Font Size Control trong Cài đặt --- */
    .font-size-control {
        gap: 10px; /* Giảm khoảng cách */
    }
    #font-size-value {
        min-width: 40px;
    }
}

@media (max-width: 400px) { /* Breakpoint cho màn hình rất nhỏ */
     :root {
         --note-gap: 8px; /* Giảm thêm khoảng cách note */
     }
     #notes-container {
        /* Đảm bảo ít nhất 1 cột hiển thị tốt */
        grid-template-columns: repeat(auto-fill, minmax(calc(100% - 20px), 1fr)); /* Chiếm gần hết chiều rộng */
     }

     .app-header h1 {
        font-size: 1.4em; /* Giảm thêm cỡ chữ tiêu đề */
     }

     .header-actions button {
        padding: 5px 8px;
        font-size: 0.8em;
     }

     .tab-button {
        padding: 8px 12px; /* Giảm padding tab */
        font-size: 0.9em;
     }
     .add-tab-button {
        padding: 6px 10px;
        font-size: 1em;
     }

     #search-input {
        padding: 8px;
        font-size: 0.95em;
     }

     .note {
        padding: 12px 15px; /* Giảm padding note */
     }
     .note-title {
        font-size: 1.1em;
     }
     .note-content {
        font-size: 0.95em;
        max-height: 150px; /* Giảm max-height nội dung */
     }
     .note-timestamp, .tag-badge {
        font-size: 0.75em;
     }

     /* Điều chỉnh Modal thêm nữa cho màn hình rất nhỏ */
     .modal-content {
         max-height: 90vh; /* Tăng lại chút nếu 85vh quá nhỏ */
         margin: 5vh auto; /* Giảm margin lại */
         padding: 10px 15px; /* Giảm padding thêm */
     }
      .modal-header h2 {
         font-size: 1.1em;
     }
     /* --- Bố cục chung với Sidebar --- */
body {
    /* Có thể cần thêm display: flex cho body hoặc tạo .app-container */
    /* display: flex; */ /* Bỏ comment nếu dùng flex cho body */
}

.app-container { /* Nếu bạn đã thêm container này trong HTML */
    display: flex;
    min-height: 100vh; /* Đảm bảo container chiếm ít nhất toàn bộ chiều cao */
}

.app-sidebar {
    width: 220px; /* Chiều rộng cố định cho sidebar */
    flex-shrink: 0; /* Ngăn sidebar bị co lại */
    background-color: var(--card-bg-color); /* Dùng màu nền thẻ note hoặc màu khác */
    border-right: 1px solid var(--border-color); /* Đường kẻ phân cách */
    padding: 20px 15px;
    display: flex;
    flex-direction: column;
    /* Có thể thêm position: fixed; height: 100vh; top: 0; left: 0; z-index: 10; */
    /* nếu muốn sidebar cố định khi cuộn trang */
}

.main-content {
    flex-grow: 1; /* Cho phép nội dung chính chiếm phần còn lại */
    /* Nếu dùng sidebar fixed: */
    /* margin-left: 220px; */ /* Đẩy nội dung sang phải bằng chiều rộng sidebar */
    padding: 0; /* Reset padding của body nếu cần */
    display: flex; /* Giúp header/main/footer bên trong dàn trang tốt hơn */
    flex-direction: column;
}

/* Cần đảm bảo header/main/footer bên trong .main-content hiển thị đúng */
.main-content > .app-header {
     /* Có thể cần điều chỉnh style header nếu nó bị ảnh hưởng */
     width: 100%; /* Chiếm toàn bộ chiều rộng của main-content */
     flex-shrink: 0;
}
.main-content > main {
    flex-grow: 1; /* Cho phép <main> chiếm không gian còn lại */
    padding: 20px; /* Thêm padding cho nội dung chính */
    /* Overflow-y: auto; */ /* Nếu nội dung dài và sidebar fixed */
}
.main-content > footer {
     width: 100%;
     flex-shrink: 0;
     /* Style lại footer nếu cần */
     padding: 15px;
     background-color: var(--bg-color); /* Nền giống body */
}


/* --- Định dạng các nút trong Sidebar --- */
.sidebar-nav ul {
    list-style: none;
    padding: 0;
    margin: 0;
}

.sidebar-nav-button {
    display: block;
    width: 100%;
    padding: 10px 15px;
    margin-bottom: 8px;
    border: none;
    background-color: transparent;
    color: var(--text-color);
    text-align: left;
    font-size: 1em; /* Hoặc 0.95em */
    font-weight: 500;
    border-radius: 6px;
    cursor: pointer;
    transition: background-color 0.2s, color 0.2s;
}

.sidebar-nav-button:hover {
    background-color: var(--setting-option-hover-bg); /* Dùng màu hover từ cài đặt */
    color: var(--primary-color);
}

.sidebar-nav-button.active {
    background-color: var(--primary-color);
    color: var(--primary-text-color);
    font-weight: 600;
}

/* --- Đảm bảo class hidden hoạt động --- */
.hidden {
    display: none !important;
}

/* Class dùng chung cho container module (nếu chưa có) */
.app-module-container {
    background-color: var(--card-bg-color); /* Hoặc var(--bg-color) nếu muốn nền khác */
    padding: 20px;
    border-radius: 8px;
    /* box-shadow: 0 1px 3px var(--shadow-color); */ /* Tuỳ chọn đổ bóng */
    /* min-height: 300px; */ /* Tuỳ chọn chiều cao tối thiểu */
}

/* CSS cho lịch sử thói quen - Cần điều chỉnh class nếu bạn đổi tên */
.modal-overlay { position: fixed; inset: 0; background-color: rgba(0, 0, 0, 0.6); display: flex; align-items: center; justify-content: center; z-index: 50; opacity: 0; visibility: hidden; transition: opacity 0.3s ease, visibility 0s linear 0.3s; }
.modal-overlay.visible { opacity: 1; visibility: visible; transition: opacity 0.3s ease, visibility 0s linear 0s; } /* Thêm class visible khi hiện */
.modal-overlay .modal-content { /* Style lại modal content theo FlexiNote */ background-color: var(--modal-content-bg); color: var(--text-color); margin: 5vh auto; padding: 20px 25px; border: 1px solid var(--modal-border-color); border-radius: 8px; width: 90%; max-width: 400px; max-height: 90vh; overflow-y: auto; box-shadow: 0 5px 15px rgba(0,0,0,0.2); position: relative; display: flex; flex-direction: column; transform: scale(0.95); transition: transform 0.3s ease; }
.modal-overlay.visible .modal-content { transform: scale(1); }
.calendar-grid { display: grid; grid-template-columns: repeat(7, minmax(0, 1fr)); gap: 0.25rem; text-align: center; margin-top: 1rem; }
.calendar-day-header { font-weight: 600; font-size: 0.75rem; color: var(--secondary-color); padding-bottom: 0.5rem; }
.calendar-day { padding: 0.5rem 0; border-radius: 9999px; font-size: 0.875rem; width: 36px; height: 36px; display: inline-flex; align-items: center; justify-content: center; margin: auto; }
.calendar-day.other-month { color: var(--border-color); } /* Màu nhạt hơn */
.calendar-day.today { background-color: var(--setting-option-hover-bg); font-weight: 600; border: 1px solid var(--primary-color); } /* Viền hoặc nền nhẹ */
.calendar-day.completed { background-color: var(--success-color); color: var(--primary-text-color); font-weight: 600; opacity: 0.8; } /* Màu thành công */
/* Style lại các nút trong modal lịch sử */
#habit-history-modal .flex button { /* Ví dụ target nút prev/next month */
     /* Áp dụng class .modal-button .secondary .small-button như trong HTML */
}
#habit-history-modal #close-history-modal-btn {
     /* Đảm bảo giống nút đóng modal khác của FlexiNote */
}

}
/* ============================================= */
/* == CSS TÍCH HỢP SIDEBAR & MODULE LAYOUT == */
/* ============================================= */

/* --- Bố cục chung --- */
/* Sử dụng Flexbox cho container chính để xếp sidebar và nội dung */
.app-container {
    display: flex;
    min-height: 100vh;
}

/* --- Định dạng Sidebar --- */
.app-sidebar {
    width: 240px; /* Có thể điều chỉnh chiều rộng */
    flex-shrink: 0; /* Không co lại */
    background-color: var(--card-bg-color); /* Nền giống thẻ note hoặc nền body */
    border-right: 1px solid var(--border-color);
    padding: 15px 10px; /* Padding bên trong sidebar */
    display: flex;
    flex-direction: column;
    box-shadow: 2px 0 5px rgba(0, 0, 0, 0.05); /* Đổ bóng nhẹ cho sidebar */
    z-index: 10; /* Đảm bảo nằm trên nếu có nội dung cuộn */
    /* Nếu muốn sidebar cố định khi cuộn: */
    /* position: fixed;
       height: 100vh;
       top: 0;
       left: 0; */
}

.sidebar-header {
    padding: 10px 15px;
    margin-bottom: 15px;
    border-bottom: 1px solid var(--border-color);
}

.sidebar-header h2 {
    margin: 0;
    font-size: 1.2em;
    font-weight: 600;
    color: var(--primary-color); /* Màu tiêu đề giống màu nhấn */
}

.sidebar-nav {
    flex-grow: 1; /* Cho phép nav chiếm không gian còn lại */
    overflow-y: auto; /* Cho phép cuộn nếu nhiều mục */
}

.sidebar-nav ul {
    list-style: none;
    padding: 0;
    margin: 0;
}

.sidebar-nav-button {
    display: flex; /* Sử dụng flex để căn icon và text */
    align-items: center;
    gap: 10px; /* Khoảng cách giữa icon và text */
    width: 100%;
    padding: 11px 15px; /* Tăng padding cho dễ bấm */
    margin-bottom: 5px; /* Giảm khoảng cách giữa các nút */
    border: none;
    background-color: transparent;
    color: var(--text-color);
    text-align: left;
    font-size: 0.95em;
    font-weight: 500;
    border-radius: 6px;
    cursor: pointer;
    transition: background-color 0.2s, color 0.2s, box-shadow 0.1s;
}

.sidebar-nav-button:hover {
    background-color: var(--setting-option-hover-bg); /* Dùng màu hover từ theme */
    color: var(--primary-color);
}

.sidebar-nav-button.active {
    background-color: var(--primary-color);
    color: var(--primary-text-color);
    font-weight: 600;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1); /* Đổ bóng nhẹ cho nút active */
}

/* Style icon bên trong nút (nếu bạn dùng emoji hoặc span/i) */
.sidebar-nav-button svg,
.sidebar-nav-button span:first-child { /* Giả sử icon là span đầu tiên hoặc svg */
    width: 18px;
    height: 18px;
    flex-shrink: 0;
    opacity: 0.8;
    margin-right: 5px; /* Thêm khoảng cách nhẹ nếu cần */
}
.sidebar-nav-button.active svg,
.sidebar-nav-button.active span:first-child {
     opacity: 1;
     /* Có thể đổi màu icon nếu cần: */
     /* color: var(--primary-text-color); */
}


.sidebar-footer {
    margin-top: auto; /* Đẩy footer xuống dưới */
    padding-top: 15px;
    border-top: 1px solid var(--border-color);
    /* Style thêm cho footer nếu cần */
}


/* --- Định dạng Khu vực Nội dung Chính --- */
.main-content {
    flex-grow: 1;
    display: flex;
    flex-direction: column;
    background-color: var(--bg-color); /* Nền chính của ứng dụng */
    /* Nếu sidebar fixed, cần thêm: */
    /* margin-left: 240px; */ /* Bằng chiều rộng sidebar + khoảng cách nếu có */
    /* overflow-y: auto; */ /* Cho phép cuộn nội dung chính */
    /* height: 100vh; */ /* Chiều cao bằng viewport */
}

/* Đảm bảo header, main, footer trong main-content co giãn đúng */
.main-content > .app-header {
    flex-shrink: 0; /* Không co header */
    position: sticky; /* Làm header dính lại khi cuộn (tuỳ chọn) */
    top: 0;
    z-index: 5; /* Nằm trên nội dung cuộn */
    background-color: var(--card-bg-color); /* Nền cho header dính */
    box-shadow: 0 1px 3px var(--shadow-color); /* Đổ bóng cho header dính */
    /* Điều chỉnh lại padding/margin của header nếu cần */
    /* padding-left: 20px; padding-right: 20px; */
}

.main-content > main {
    flex-grow: 1;
    padding: 20px; /* Padding cho nội dung bên trong thẻ main */
}

.main-content > footer {
    flex-shrink: 0;
    padding: 15px 20px;
    text-align: center;
    font-size: 0.85em;
    color: var(--secondary-color);
    background-color: var(--bg-color); /* Nền footer */
    border-top: 1px solid var(--border-color);
}

/* --- Các class tiện ích --- */
.hidden {
    display: none !important;
}

/* Style cơ bản cho container module (để thấy được khi chuyển đổi) */
.app-module-container {
    /* Bạn có thể giữ lại style từ App 2 hoặc định nghĩa lại ở đây */
    background-color: var(--card-bg-color); /* Nền giống thẻ note */
    padding: 25px;
    border-radius: 8px;
    box-shadow: 0 2px 5px var(--shadow-color);
    /* Thêm các style khác nếu muốn */
}
